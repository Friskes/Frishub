{% extends 'main_app/base.html' %}

{% load static %}
{% load i18n %}

{% block head %}
<script id="viewer"></script>

<script>
  let CUR_MODEL_ZOOM = -3;

  const GENDERS = {
    0: 'Male',
    1: 'Female'
  };

  const DEFAULT_SLOT_ICONS = {
    1: 'inventoryslot_head',
    3: 'inventoryslot_shoulder',
    16: 'inventoryslot_chest', // Back
    5: 'inventoryslot_chest',
    4: 'inventoryslot_shirt',
    19: 'inventoryslot_tabard',
    9: 'inventoryslot_wrists',
    10: 'inventoryslot_hands',
    6: 'inventoryslot_waist',
    7: 'inventoryslot_legs',
    8: 'inventoryslot_feet',
    21: 'inventoryslot_mainhand',
    22: 'inventoryslot_offhand',
    23: 'inventoryslot_ranged',
    '021': 'inventoryslot_enchant',
    '022': 'inventoryslot_enchant'
  };

  const ITEM_QUALITIES = {
    0: 'poor-wow',      // (gray)
    1: 'common-wow',    // (white)
    2: 'uncommon-wow',  // (green)
    3: 'rare-wow',      // (blue)
    4: 'epic-wow',      // (purple)
    5: 'legendary-wow', // (orange)
    7: 'heirloom-wow'   // (blizzard blue) фамильные
  };

  const TYPEID_BY_SLOTID = {
    // slotId: type
    1: 2,
    3: 4,
    21: 1,
    22: 1,
    23: 1
  };


  function getCharDataFromContext() {
    let character_data = "{{ character_data }}";
    if (!character_data) return null;

    character_data = JSON.parse(character_data.replace(/&quot;/g, '"'));

    if (character_data.items === "") {
      character_data.items = [];
    } else {
      const items = character_data.items.split(',');
      character_data.items = [];

      for (let i=0; i < items.length; i=i+4) {
        character_data.items.push([
          parseInt(items[i]),
          parseInt(items[i+1]),
          parseInt(items[i+2]),
          parseInt(items[i+3])
        ]);
      };
    };

    character_data.face = character_data.face === ""
    ? []
    : character_data.face.split(',').map(x => parseInt(x));

    return character_data;
  };
  const charData = getCharDataFromContext();

  window.GAME_PATCH = charData.game_patch; // для CONTENT_PATH в model_viewer_utils


  let RACES = {
    1: "Human",
    2: "Orc",
    3: "Dwarf",
    4: "Nightelf",
    5: "Scourge",
    6: "Tauren",
    7: "Gnome",
    8: "Troll",
    9: "Goblin",
    10: "Bloodelf",
    11: "Draenei",
    12: "Felorc",
    13: "Naga_",
    14: "Broken",
    15: "Skeleton",
    16: "Vrykul",
    17: "Tuskarr",
    18: "Foresttroll",
    19: "Taunka",
    20: "Northrendskeleton",
    21: "Icetroll"
  };
  const WRATH_RACES_LEN = Math.max(...Object.keys(RACES));

  const LIVE_RACES = {
    // вызывают ошибку на wrath
    22: "Worgen",
    // 23: "Gilnean", // дубль Human
    24: "Pandaren",
    // 25: "Pandarena", // дубль Pandaren
    // 26: "Pandarenh", // дубль Pandaren
    27: "Nightborne",
    28: "Highmountaintauren",
    29: "Voidelf",
    30: "Lightforgeddraenei",
    31: "Zandalaritroll",
    32: "Kultiran",
    33: "Thinhuman",
    34: "Darkirondwarf",
    35: "Vulpera",
    36: "Magharorc",
    37: "Mechagnome"
  };

  const ALL_RACES = Object.assign(LIVE_RACES, RACES);

  if (charData.game_patch === 'live') RACES = ALL_RACES;

  const RACES_LEN = Math.max(...Object.keys(RACES));

  const ONLY_MALE_RACES = [
    // wrath
    12, // "Felorc"
    14, // "Broken"
    15, // "Skeleton"
    16, // "Vrykul"
    17, // "Tuskarr"
    18, // "Foresttroll"
    19, // "Taunka"
    20, // "Northrendskeleton"
    21, // "Icetroll"
    // live
    33  // "Thinhuman"
  ];

  const RACES_WITHOUT_ICON = [
    // wrath
    12, // "Felorc"
    13, // "Naga_"
    14, // "Broken"
    15, // "Skeleton"
    16, // "Vrykul"
    17, // "Tuskarr"
    18, // "Foresttroll"
    19, // "Taunka"
    20, // "Northrendskeleton"
    21, // "Icetroll"
    // live
    // 23, // "Gilnean"
    // 25, // "Pandarena"
    // 26, // "Pandarenh"
    33  // "Thinhuman"
  ];

  const WRATH_MOUNTS_LEN = 290;
  const WRATH_ENCHANTS_LEN = 28;


  // Actual model and UI parameters
  window.dressUI = {
    game_patch: charData.game_patch,
    room_creator: charData.room_creator,
    allow_edit: charData.allow_edit,
    // Default model options
    model_opts: {
      race: charData.race,
      gender: charData.gender,
      items: charData.items,
      // 'Оружия ближнего боя':
      // 15, 22, 23 (лев. рука)
      // 13, 17, 21, 25, 26 (прав. рука)
      // 'все дальнобойные кроме луков':
      // 15, 22, 23 (лев. рука)
      // 13, 17, 21, 25, 26 (прав. рука)
      // 'только луки':
      // 15, 22, 23 (лев. рука)
      sheathMain: -1,
      sheathOff: -1,
      generalOptions: {
        mount: {type: 8, id: 0},
        // pet: {type: 8, id: 0, scale: 0.8, offset: [0, -1.15, 0]}, // X, Y, Z
        // background: "background-181818.png",
        // background: "background-classic-181818.png",
        // background: "background-classic-ddd.png"
      }
    },
    active_cat: 'gear',
    gear: {
      items_menu: {
        slot1:  {name: 'Head',     quality: 4, index: 0, type: 'Cloth', available_types: ["Cloth", "Leather", "Mail", "Plate", "Miscellaneous"]},
        slot3:  {name: 'Shoulder', quality: 4, index: 0, type: 'Cloth', available_types: ["Cloth", "Leather", "Mail", "Plate", "Miscellaneous"]},
        slot16: {name: 'Back',     quality: 4, index: 0, type: 'Cloth', available_types: ["Cloth"]},
        slot5:  {name: 'Chest',    quality: 4, index: 0, type: 'Cloth', available_types: ["Cloth", "Leather", "Mail", "Plate", "Miscellaneous"]},
        slot4:  {name: 'Shirt',    quality: 4, index: 0, type: 'Miscellaneous', available_types: ["Miscellaneous"]},
        slot19: {name: 'Tabard',   quality: 4, index: 0, type: 'Miscellaneous', available_types: ["Miscellaneous"]},
        slot9:  {name: 'Wrist',    quality: 4, index: 0, type: 'Cloth', available_types: ["Cloth", "Leather", "Mail", "Plate", "Miscellaneous"]},
        slot10: {name: 'Hands',    quality: 4, index: 0, type: 'Cloth', available_types: ["Cloth", "Leather", "Mail", "Plate", "Miscellaneous"]},
        slot6:  {name: 'Waist',    quality: 4, index: 0, type: 'Cloth', available_types: ["Cloth", "Leather", "Mail", "Plate", "Miscellaneous"]},
        slot7:  {name: 'Legs',     quality: 4, index: 0, type: 'Cloth', available_types: ["Cloth", "Leather", "Mail", "Plate"]},
        slot8:  {name: 'Feet',     quality: 4, index: 0, type: 'Cloth', available_types: ["Cloth", "Leather", "Mail", "Plate", "Miscellaneous"]},
        slot21: {name: 'MainHand', quality: 4, index: 0, type: 'Axe', available_types: ["Axe", "Sword", "Mace", "Dagger", "Fist Weapon", "Staff", "Polearm", "Fishing Pole", "Exotic", "Miscellaneous"]},
        slot22: {name: 'OffHand',  quality: 4, index: 0, type: 'Axe', available_types: ["Axe", "Sword", "Mace", "Dagger", "Fist Weapon", "Shield", "Miscellaneous"]},
        slot23: {name: 'Ranged',   quality: 4, index: 0, type: 'Bow', available_types: ["Bow", "Gun", "Wand", "Crossbow", "Thrown"]},
        slot021: {name: 'Enchants', quality: 1, index: 0, type: '', available_types: []},
        slot022: {name: 'Enchants', quality: 1, index: 0, type: '', available_types: []}
      }
    },
    char: {
      race_id: charData.race,
      gender_id: charData.gender,
      anim: 0,
      default_anim: 0,
      mount: parseInt(charData.mount),
      sheath: 0,
      sheath_opts: [-1, -1],
      only_item: false,
      only_item_data: {type: 1, id: 58187, itemId: 45176, slotId: 21} // меч из пенопласта
    },
    face: {
      id: '#dressing-room-face-settings',
      key: 'face',
      fields: [],
      max_len: [],
      min_len: [],
      current: charData.face,
      have_text_opt: []
    }
  };


  function slotIdIsExists(slotId, items=window.dressUI.model_opts.items) {
    for (const i in items) {
      if (items[i][0] == slotId) return i;
    };
    return false;
  };

  // быть в руке/на персонаже MH и OF могут только вместе.
  // -1 // оружие в руке
  //  1 // оружие на спине смотрит вниз
  //  2 // оружие на спине смотрит вверх
  //  3 // оружие на поясе

  function updateSheathInfo() {
    const slot21 = slotIdIsExists(21);
    const slot22 = slotIdIsExists(22);
    const slot23 = slotIdIsExists(23);

    if (slot21 === false && slot22 === false && slot23 === false) {
      // console.log('все слоты пустые');
      window.dressUI.char.sheath_opts = [[-1, -1]];

    } else if (slot21 !== false && slot22 === false && slot23 === false) {
      // console.log('только первый слот занят');
      window.dressUI.char.sheath_opts = [[-1, -1], [1, 1], [2, 2]];

    } else if (slot21 === false && slot22 !== false) {
      // console.log('только второй слот занят');
      window.dressUI.char.sheath_opts = [[-1, -1], [3, 3], [1, 1], [1, 3], [3, 1]];

    } else if (slot21 === false && slot23 !== false) {
      // console.log('только третий слот занят');
      window.dressUI.char.sheath_opts = [[-1, -1], [1, 1]];

    } else if (slot21 !== false && slot22 !== false) {
      // console.log('только первый и второй слоты заняты');
      window.dressUI.char.sheath_opts = [[-1, -1], [3, 3], [1, 1], [1, 3], [3, 1]];

    } else if (slot21 !== false && slot23 !== false) {
      // console.log('только первый и третий слоты заняты');
      window.dressUI.char.sheath_opts = [[-1, -1], [3, 3], [1, 1], [1, 3], [3, 1]];
    };
    setSheath();
  };


  const LOCAL_VIEWER = `/static/main_app/javascript/wow-model-viewer/viewer_${window.dressUI.game_patch}.js`;
  const LOCAL_VIEWER_MIN = `/static/main_app/javascript/wow-model-viewer/viewer_${window.dressUI.game_patch}.min.js`;
  const UNLOCAL_VIEWER_MIN = `https://wow.zamimg.com/modelviewer/${window.dressUI.game_patch}/viewer/viewer.min.js`;
  document.querySelector('#viewer').src = LOCAL_VIEWER_MIN;

  const WH_TOOLTIP_LIVE = ''; // актуал
  const WH_TOOLTIP_WOTLK = 'wotlk/';
  const WH_TOOLTIP_URL = `https://www.wowhead.com/${WH_TOOLTIP_WOTLK}{% if LANGUAGE_CODE == 'ru' %}ru/{% else %}{% endif %}`;

  const DEFAULT_ICON_URL = 'https://wow.zamimg.com/images/wow/icons/large/'; // small // medium // large
  // const DEFAULT_ICON_URL = `https://render-classic-us.worldofwarcraft.com/icons/56/`; // 18 // 36 // 56


  const csrftoken = Cookies.get('csrftoken');
  const sendAjaxRequest = function() {
    $('.save-char-opts-icon').css('display', 'block');

    const data = {
      allow_edit: window.dressUI.allow_edit,
      game_patch: window.dressUI.game_patch,
      race: window.dressUI.model_opts.race,
      gender: window.dressUI.model_opts.gender,
      items: window.dressUI.model_opts.items.join(),
      face: window.dressUI.face.current.join(),
      mount: window.dressUI.char.mount
    };

    $.ajax({
      type: 'POST',
      dataType: 'JSON',
      url: "{% url 'unique_dressing_room' room_id %}", // window.location.pathname
      data: JSON.stringify(data),
      headers: {'X-CSRFToken': csrftoken},

      success: function(data, textStatus, jqXHR) {
        // console.log(data);
        setTimeout(() => $('.save-char-opts-icon').css('display', 'none'), 500);
      },

      error: function (jqXHR, textStatus, errorThrown) {
        $('.save-char-opts-icon').css('display', 'none');
        warnMessageHandler(4000,
        "{% trans 'Создатель этой комнаты запретил изменение персонажа другими пользователями во время вашей сессии, любые изменения настроек не будут сохранены.' %}" + `\n${jqXHR.status} ${errorThrown}`);
      }
    });
  };
  const debounce_sendAjaxRequest = debounce(sendAjaxRequest, "{% if debug_mode %}300{% else %}3000{% endif %}");


  const IGNORED_WRAPPED_PROPS = [
    'gear', 'char', 'generalOptions'
  ];
  const IGNORED_PROPS = [
    'active_cat', 'sheathMain', 'sheathOff', 'AnimIsPaused', 'saved_rooms', 'show',
    'game_patch' // игнорирую изменение свойства, вручную отправляю Ajax Request без задержки из хендлера
  ];
  // https://learn.javascript.ru/proxy
  function wrapDressUI(target) {
    const handler = {

      // get: function(target, property) {
      //   const value = target[property];
      //   return typeof value === "object" ? new Proxy(value, handler) : value;
      // },

      // get: function(target, property) {
      //   if (typeof target[property] === 'object' && target[property] !== null) {
      //     return new Proxy(target[property], handler);
      //   } else {
      //     return target[property];
      //   };
      // },

      get: function(target, property) {
        if (property === 'isProxy') return true;

        const value = target[property];

        if (typeof value === 'undefined' || value === null) return;

        if (IGNORED_WRAPPED_PROPS.indexOf(property) === -1) {
          if (!value.isProxy && typeof value === 'object') target[property] = new Proxy(value, handler);
        };
        return target[property];
      },

      set: function(target, property, newValue) {
        target[property] = newValue;

        if (IGNORED_PROPS.indexOf(property) === -1) {
          if (window.dressUI.room_creator || window.dressUI.allow_edit) debounce_sendAjaxRequest();
        };
        return true;
      }
    };
    return new Proxy(target, handler);
  };
  window.dressUI = wrapDressUI(window.dressUI);
</script>

<link rel="stylesheet" type="text/css" href="{% static 'main_app/css/dressing-room.css' %}">

<style>
  .dress-btn {
    user-select: none;
    border: 0;
    border-radius: 2px;
    color: #cccccc;
    cursor: pointer;
    display: inline-block;
    font-family: "Open Sans", Arial, "Helvetica Neue", Helvetica, sans-serif;
    font-size: 13px;
    font-weight: 600 !important;
    line-height: 1.4;
    margin-bottom: 0;
    padding: 6px 12px;
    text-align: center;
    vertical-align: middle;
    white-space: nowrap
  }
  .dress-btn:focus {
    box-shadow: 0 0 0 0;
  }
  .btn-site:hover,
  .btn-site:active {
    color: #676af7 !important;
  }
  .btn-site[disabled],
  .btn-site.btn-disabled {
    opacity: 0.3;
  }
</style>

<style>
  input[type="checkbox"] {
    background: transparent;
    border: 0;
    cursor: pointer;
    font-size: inherit;
    margin: 0.1em 0.25em 0;
    padding: 0;
    top: auto !important;
    -moz-appearance: initial
  }
  input[type="checkbox"],
  input[type="checkbox"]:before {
    line-height: inherit !important;
    vertical-align: top
  }
  input[type="checkbox"]::-ms-check {
    width: 1.2em;
  }
  input[type="checkbox"]:after {
    background: rgba(30, 30, 30, 1);
    border-radius: 1px;
    border: 0.125em solid #444;
    box-sizing: border-box;
    content: "";
    display: inline-block;
    height: 1.2em;
    width: 1.2em;
  }
  input[type="checkbox"]::-ms-check {
    background: rgba(30, 30, 30, 1);
    border-radius: 4px;
    border: 0.125em solid #444;
    box-sizing: border-box;
    content: "";
    display: inline-block;
    height: 1.2em;
    width: 1.2em;
    color: #ffd100
  }
  input[type="checkbox"]:checked:before {
    display: inline-block;
    font: normal normal normal 14px FontAwesome;
    font-size: inherit;
    -moz-osx-font-smoothing: grayscale;
    -webkit-font-smoothing: antialiased;
    text-decoration: none;
    text-rendering: auto;
    content: "";
    color: #ffd100;
    margin-right: 0
  }
  input[type="checkbox"]:checked:before {
    font-size: 1.5em;
    margin: -.2em 0 0 -.05em;
    line-height: 1 !important;
    pointer-events: none;
    position: absolute
  }
  input[type="checkbox"] {
    margin: 0.1em 0.25em 0 !important;
    vertical-align: top !important
  }
  input[type="checkbox"] {
    margin: 12px 12px 0 0 !important;
    position: relative;
    top: 2px;
  }
</style>

<style>
  .paperdoll {
    /* бэкграунд под моделью */
    /* background: #202020; */
    border-radius: 6px;
    line-height: 0;

    /* min-height: 362px; */
    max-height: 620px !important;

    min-width: 300px;
    /* overflow: hidden; */
    position: relative
  }
  .paperdoll div {
    line-height: normal
  }
  .paperdoll .paperdoll-left,
  .paperdoll .paperdoll-right,
  .paperdoll .paperdoll-bottom {
    pointer-events: none
  }
  .paperdoll .paperdoll-left>*:not(.paperdoll-hidden),
  .paperdoll .paperdoll-right>*:not(.paperdoll-hidden),
  .paperdoll .paperdoll-bottom>*:not(.paperdoll-hidden) {
    pointer-events: auto
  }
  .paperdoll .paperdoll-left,
  .paperdoll .paperdoll-right {
    bottom: 55px;
    position: absolute;
    top: 3px;
    width: 44px;
    z-index: 11
  }
  .paperdoll .paperdoll-left {
    left: 3px;
  }
  .paperdoll .paperdoll-right {
    right: 3px;
  }
  .paperdoll .paperdoll-bottom {
    bottom: 47px;
    height: 0;
    left: 0;
    position: absolute;
    text-align: center;
    white-space: nowrap;
    width: 100%;
    z-index: 12;
    user-select: none;
  }
  .paperdoll .paperdoll-bottom .paperdoll-enchant {
    transform: scale(0.75);
  }
  .paperdoll .paperdoll-model {
    bottom: 47px;
    left: 47px;
    min-width: 277px;
    position: absolute;
    right: 47px;
    top: 0;
    z-index: 1
  }
  .paperdoll .paperdoll-model-inner {
    bottom: 0;
    height: auto !important;
    left: 0;
    position: absolute !important;
    right: 0;
    top: 0;
    width: auto !important
  }
  .paperdoll .paperdoll-model-inner canvas {
    height: 100%;
    width: 100%;
    max-height: 100%;
    max-width: 100%;
  }
  .paperdoll .paperdoll-responsive-shell {
    line-height: 0;
    margin: 0 47px 47px;
    position: relative;
    width: calc(100% - 94px)
  }
  .paperdoll .paperdoll-responsive-expander {
    /* margin-top: 131.407942238%; */
    margin-top: 999%;
  }
  .paperdoll .paperdoll-hidden.iconlarge,
  .paperdoll .paperdoll-hidden.iconmedium,
  .paperdoll .paperdoll-hidden.iconsmall {
    opacity: .2
  }
  .paperdoll .paperdoll-hidden.iconlarge,
  .paperdoll .paperdoll-hidden.iconlarge *,
  .paperdoll .paperdoll-hidden.iconmedium,
  .paperdoll .paperdoll-hidden.iconmedium *,
  .paperdoll .paperdoll-hidden.iconsmall,
  .paperdoll .paperdoll-hidden.iconsmall * {
    pointer-events: none
  }
  .fullscreen-icon {
    color: #cccccc;
  }
  .fullscreen-icon:hover {
    color: #cccccc;
  }
  .paperdoll .paperdoll-controls-left {
    bottom: 16px;
    font-size: 12px;
    left: 5px;
    line-height: 1.2;
    position: absolute;
    right: calc(50% - -44px);
    text-align: left;
    z-index: 10
  }
  .paperdoll .paperdoll-controls-left div {
    margin: 3px 0 0
  }
  .paperdoll .paperdoll-controls-left div:first-child {
    margin: 0
  }
  .paperdoll .paperdoll-quality a {
    font-size: 14px
  }
  .paperdoll .paperdoll-quality .active {
    color: #fff;
    cursor: default;
    font-weight: bold
  }
  .paperdoll .paperdoll-mount {
    display: none;
    line-height: 26px;
    margin-left: -2px !important;
    white-space: nowrap
  }
  .paperdoll .paperdoll-mount>a {
    background: url(https://wow.zamimg.com/images/Paperdoll/red-drake.png) left bottom no-repeat;
    border-radius: 0 0 0 6px;
    box-sizing: border-box;
    float: left;
    font-size: 13px;
    font-weight: bold;
    height: 60px;
    margin: 0 0 -5px -3px;
    min-width: 74px;
    padding: 37px 0 0 5px;
    text-shadow: 1px 1px 1px #202020;

    letter-spacing: .05em;
    text-decoration: none;
  }
  .paperdoll .paperdoll-mount>a:hover {
    -webkit-filter: brightness(1.35);
    filter: brightness(1.35);

    color: white;
  }
  .paperdoll .paperdoll-mount:after {
    content: ' ';
    clear: left;
    display: block
  }
  .paperdoll[data-icon-size="large"] .paperdoll-left,
  .paperdoll[data-icon-size="large"] .paperdoll-right {
    width: 68px
  }
  .paperdoll[data-icon-size="large"] .paperdoll-bottom {
    bottom: 71px
  }
  .paperdoll[data-icon-size="large"] .paperdoll-responsive-shell {
    margin: 0 71px 71px
  }
  .paperdoll[data-icon-size="large"] .paperdoll-controls-left {
    right: calc(50% - -68px)
  }
  .paperdoll-enchant-disabled {
    opacity: 0.2;
    pointer-events: none !important
  }

  .caret-disabled {
    opacity: 0.5;
    pointer-events: none !important;
  }
</style>

<style>
  .fa-caret-left:before {
    content: "\f0d9"
  }
  .fa-caret-right:before {
    content: "\f0da"
  }
  .fa-times:before {
    content: "\f00d"
  }
  .fa-eye-slash:before {
    content: "\f070"
  }
  .fa-link:before {
    content: "\f0c1"
  }
  .fa-camera:before {
    content: "\f030"
  }
  .fa-pause:before {
    content: "\f04c"
  }
  .fa-play:before {
    content: "\f04b"
  }
  .fa-random:before {
    content: "\f074"
  }
  .fa-undo:before {
    content: "\f0e2"
  }
  .fa-repeat:before {
    content: "\f01e"
  }
  .fa-expand:before {
    content: "\f065"
  }
  .fa-square:before {
    content: "\f0c8"
  }
  .fa-check-square:before {
    content: "\f14a"
  }

  .fa-user:before {
    content: "\f007"
  }
  .fa-users:before {
    content: "\f0c0"
  }

  .fa-external-link:before {
    content: "\f08e"
  }
  .fa-external-link-square:before {
    content: "\f14c"
  }

  .fa-calendar:before {
    content: "\f073"
  }
  .fa-calendar-o:before {
    content: "\f133"
  }

  .fa-spinner:before {
    content: "\f110"
  }

  .fa-list-ul:before {
    content: "\f0ca"
  }
  .fa-list-ol:before {
    content: "\f0cb"
  }

  .fa-database:before {
    content: "\f1c0"
  }
  .fa-cloud-upload:before {
    content: "\f0ee"
  }
  .fa-cog:before {
    content: "\f013"
  }
  .fa-refresh:before {
    content: "\f021"
  }

  .fa-spin {
    -webkit-animation: faspin 1s infinite steps(99);
    animation: faspin 1s infinite steps(99);
  }
  @keyframes faspin {
    0% {
      -webkit-transform: rotate(0deg);
      transform: rotate(0deg);
    }
    100% {
      -webkit-transform: rotate(360deg);
      transform: rotate(360deg);
    }
  }

  .save-char-opts-icon {
    display: none;
    position: absolute;
    top: -26px;
    left: 0;
    right: 0;
    font-size: 20px;
    opacity: 0.5;
  }
</style>

<style>
  .btn-close-items-menu-left {
    cursor: Pointer;
    height: 24px;
    width: auto;
    margin-right: 3%;
  }
  .btn-close-items-menu-right {
    cursor: Pointer;
    height: 24px;
    width: auto;
    margin-left: 3%;
  }
  .items-menu-table {
    max-height: 173px;
    display: grid;

    font-size: 14px !important;
  }
  .items-menu-table a span, .items-menu-table a span del {
    width: 28px !important;
    height: 28px !important;
    margin: 0 !important;
  }
  .items-menu-table a span ins {
    width: 22px !important;
    height: 22px !important;
    top: 3px !important;
    left: 3px !important;
  }

  .paperdoll-left, .paperdoll-right, .paperdoll-bottom {
    z-index: auto !important;
  }
  /* .slot-container {
    z-index: auto !important;
  } */
  .iconlarge {
    z-index: 13 !important;
  }

  .table-responsive {
    max-width: 317px;
  }

  .items-menu {
    z-index: 14 !important;

    position: absolute;
    display: none;
    min-width: 326px;
    height: auto;
    border: 2px solid #1fb8ff;
    border-radius: 4px 4px 4px 4px;
    background-color: rgba(0, 0, 0, 1);
    font-size: 12px;
    line-height: 19px;
    text-align: center;
    box-shadow: 0 0 30px 10px #ffffff12;
    padding: 6px 1px 8px 0; /* top, right, bottom, left */
    margin-top: -10px;
  }

  .items-menu-left-up {
    right: 3px;
  }
  .items-menu-left-down {
    right: 3px;
  }
  .items-menu-left-down-crutch {
    bottom: 66px;
  }

  .items-menu-right-up {
    left: 3px;
  }
  .items-menu-right-down {
    left: 3px;
  }

  .items-menu-bottom-left {
    left: 123px;
    top: 2px;
  }
  .items-menu-bottom-left-enchant {
    left: 67px;
    top: 9px;
  }
  .items-menu-bottom-center {
    right: 193px;
    top: 2px;
  }
  .items-menu-bottom-right {
    right: 124px;
    top: 2px;
  }
  .items-menu-bottom-right-enchant {
    right: 67px;
    top: 9px;
  }

  /* Если мы на мобильном */
  @media screen and (max-width: 800px) {
    .items-menu-table {
      max-height: 159px;
    }

    .table-responsive {
      max-width: 309px;
    }

    .items-menu {
      min-width: 318px;
      margin-top: 0px;
      /* width: 100vw; */
    }

    .items-menu-left-up {
      left: -17px;
    }
    .items-menu-left-down {
      left: -17px;
    }
    .items-menu-left-down-crutch {
      bottom: 35px;
    }

    .items-menu-right-up {
      left: -266px;
    }
    .items-menu-right-down {
      left: -266px;
    }

    .items-menu-bottom-left, .items-menu-bottom-left-enchant,
    .items-menu-bottom-center, .items-menu-bottom-right,
    .items-menu-bottom-right-enchant {
      left: -7px;
      top: 35px;
    }
  }
</style>

<style>
  .warning-toast-message {
    display: none;
    position: absolute;
    margin: auto;
    top: calc(35%);
    left: 0;
    right: 0;
    max-width: 35%;
    z-index: 14;
    border-radius: 15%;
    background-color: rgba(0, 0, 0, 0.5);
    user-select: none;
    pointer-events: none;
  }
  /* Если мы на мобильном */
  @media screen and (max-width: 379px) {
    .warning-toast-message {
      top: calc(20%);
      max-width: 60%;
    }
  }
  .warning-toast-message-icon {
    font-size: 50px;
  }
  .warning-toast-message-text {
    padding: 0 15px 15px 15px;
    font-size: 22px;
    font-weight: 600;
    white-space: break-spaces;
  }
</style>

<style>
  .first-btn-wow {
    font-size: 21px;
    padding: 0 2px 0 4px;
  }
  .first-btn-wow:hover {
    opacity: 0.5;
  }
  .medium-btn-wow {
    font-size: 21px;
    padding: 0 2px 0 2px;
  }
  .medium-btn-wow:hover {
    opacity: 0.5;
  }
  .last-btn-wow {
    font-size: 21px;
    padding: 0 4px 0 2px;
  }
  .last-btn-wow:hover {
    opacity: 0.5;
  }

  .poor-wow {
    color: #9d9d9d;
  }
  .poor-wow:hover {
    color: #9d9d9d;
  }
  .common-wow {
    color: #ffffff;
  }
  .common-wow:hover {
    color: #ffffff;
  }
  .uncommon-wow {
    color: #1eff00;
  }
  .uncommon-wow:hover {
    color: #1eff00;
  }
  .rare-wow {
    color: #0070dd;
  }
  .rare-wow:hover {
    color: #0070dd;
  }
  .epic-wow {
    color: #a01cf8;
  }
  .epic-wow:hover {
    color: #a01cf8;
  }
  .legendary-wow {
    color: #ff8000;
  }
  .legendary-wow:hover {
    color: #ff8000;
  }
  .heirloom-wow {
    color: #00ccff;
  }
  .heirloom-wow:hover {
    color: #00ccff;
  }
</style>

<style>
  .text-uline {
    text-decoration: underline;
  }

  .dressing-room-character-controls-category-option>div[data-role="control"] {
    user-select: none;
  }
  .dressing-room-character-controls-category-option>div[data-role="control"] .imitation-select {
    pointer-events: none;
  }

  .dressing-room-character-controls-category-switchers a[data-category="patch"]:after {
    background: left;
    background-size: auto 100%;
  }

  .dressing-room-character-controls-category[data-category="face"],
  .dressing-room-character-controls-category[data-category="character"] {
    user-select: none;
  }

  .my-saved-rooms-container {
    /* display: grid; */
    display: none;
    margin: auto;
    max-width: max-content;
    position: relative;
    bottom: 30px;
  }
  .my-saved-rooms-title {
    display: flex;
    text-align: left;
    font-weight: bold;
  }
  .my-saved-rooms {
    display: grid;
    max-height: 145px;
  }
  .rooms-list-link {
    text-align: left;
    margin-right: 5px;
    color: #fff;
  }
  .rooms-list-img {
    display: inline-block;
    width: 21px;
    padding-bottom: 8px;
    margin-right: 5px;
  }
  .rooms-list-link:hover {
    color: #fff;
    opacity: 0.7;
  }
  .rooms-list-link:hover .rooms-list-img {
    opacity: 0.7;
  }
</style>

<style>
  .mounts-menu {
    display: none;
    height: auto !important;
    pointer-events: all;
    right: -66px;
    top: -66px;
  }
  .listview-scroller-horizontal {
    overflow-x: auto;
    position: relative
  }
  .listview-scroller-vertical {
    overflow: auto;
    width: 400px;
    height: 517px;
  }
  .listview-mode-tiled {
    display: grid;
    grid-auto-rows: 1fr;
    grid-template-columns: repeat(auto-fit, minmax(190px, 1fr));
  }
  /* Если мы на смартфоне */
  @media screen and (max-width: 767px) {
    .mounts-menu {
      right: -7px;
      top: 365px;
    }
    .listview-scroller-vertical {
      width: auto !important;
      height: 365px;
    }
    .listview-mode-tiled {
      grid-template-columns: repeat(auto-fit, minmax(130px, 1fr));
    }
  }
  .listview-mode-tiled>div {
    border-radius: 4px;
    display: block
  }
  .listview-mode-tiled>div:hover {
    background-color: #181818
  }
  .listview-mode-tiled.clickable>div {
    cursor: pointer
  }
  .screenshot-cell {
    cursor: auto;
    padding: 10px 4px;
    text-align: center;
    vertical-align: top;
  }
  .screenshot-cell img {
    border-radius: 3px;
    margin-bottom: 3px;
    max-height: 125px;
    max-width: 125px;
  }
  .screenshot-cell a:hover img {
    filter: brightness(1.35)
  }
  .screenshot-caption-wrapper {
    height: 2em;
    position: relative;
  }
  .screenshot-caption-wrapper:first-child {
    margin-top: 40.5%
  }
  .screenshot-caption {
    box-sizing: border-box;
    height: 2em;
    left: 0;
    line-height: 18px;
    overflow: hidden;
    padding: 1px;
    position: absolute;
    top: 0;
    width: 100%;
    z-index: 0
  }
  .close-mounts-menu-top-up {
    width: 100%;
    position: absolute;
    z-index: 2;
    display: flex;
    justify-content: right;
    pointer-events: none;
  }
  .close-mounts-menu-btn {
    font-size: 17px;
    pointer-events: all;
    position: relative;
    right: 15px;
    bottom: 8px;
  }
</style>

<style>
  .anims-menu {
    display: none;
    height: auto !important;
    pointer-events: all;
    right: -66px;
    top: 181px;
  }
  /* Если мы на смартфоне */
  @media screen and (max-width: 767px) {
    .anims-menu {
      right: -7px;
      top: 538px;
    }
  }
</style>

<style>
  .races-menu {
    display: none;
    height: auto !important;
    pointer-events: all;
    right: -66px;
    top: 69.5px;
  }
  /* Если мы на смартфоне */
  @media screen and (max-width: 767px) {
    .races-menu {
      right: -7px;
      top: 427px;
    }
  }
  .races-menu-img {
    display: inline-block;
    width: 21px;
    margin-right: 5px;
    position: relative;
    bottom: 2px;
  }
</style>
{% endblock %}

{% block body %}
<app-dressing-room _nghost-gox-c37="" style="font-size: 14.5px;">
  <div _ngcontent-gox-c37="" class="page-size bg-check p-2 p-md-5 mb-5" style="overflow: hidden;">
    <div _ngcontent-gox-c37="" class="m-auto text-center" style="padding-top: 70px; padding-bottom: 70px;">
      <div _ngcontent-gox-c37="" class="mb-2">

        <div id="dressing-room" class="dressing-room" data-loaded="true">

          <div class="my-saved-rooms-container">
            <span class="my-saved-rooms-title">{% trans 'Сохранённые комнаты' %}:</span>
            <div class="table-responsive my-saved-rooms"></div>
          </div>

          <div class="dressing-room-character" data-class="1" data-race="10" data-npc-race="false"
            data-gender="0" data-gender-restriction="no-restriction" data-category="gear">

            <div class="fa fa-refresh fa-spin save-char-opts-icon"></div>

            <div class="paperdoll" id="dressing-room-paperdoll" data-icon-size="large" data-separate-shoulders="false">

              <div class="paperdoll-left">
                <div class="slot-container">
                  <div class="iconlarge" data-env="live" data-tree="live" data-game="wow" data-character-slot="1">
                    <ins style="background-image: url(&quot;https://wow.zamimg.com/images/wow/icons/large/inventoryslot_head.jpg&quot;);"></ins>
                    <del></del>
                    <a href="javascript:"></a>
                  </div>
                  <div class="items-menu items-menu-left-up">
                    <div class="d-block d-md-block mb-2">
                      <div class="dressing-room-character-controls-category-option" data-character-customization-type="item_type"
                        style="align-items: center; justify-content: center;">
                        <a class="btn dress-btn fa fa-square first-btn-wow poor-wow" href="javascript:" tabindex="-1" data-quality="0"></a>
                        <a class="btn dress-btn fa fa-square medium-btn-wow common-wow" href="javascript:" tabindex="-1" data-quality="1"></a>
                        <a class="btn dress-btn fa fa-square medium-btn-wow uncommon-wow" href="javascript:" tabindex="-1" data-quality="2"></a>
                        <a class="btn dress-btn fa fa-square medium-btn-wow rare-wow" href="javascript:" tabindex="-1" data-quality="3"></a>
                        <a class="btn dress-btn fa fa-check-square medium-btn-wow epic-wow" href="javascript:" tabindex="-1" data-quality="4"></a>
                        <a class="btn dress-btn fa fa-square medium-btn-wow legendary-wow" href="javascript:" tabindex="-1" data-quality="5"></a>
                        <a class="btn dress-btn fa fa-square last-btn-wow heirloom-wow" href="javascript:" tabindex="-1" data-quality="7"></a>
                        <div tabindex="0" data-role="control" data-disabled="false" id="select_item_type_btn" style="padding-right: 2px;">
                          <a class="btn dress-btn fa fa-caret-left" href="javascript:" tabindex="-1"></a>
                          <a class="imitation-select" data-field-filled="true" href="javascript:" tabindex="-1"></a>
                          <a class="btn dress-btn fa fa-caret-right" href="javascript:" tabindex="-1"></a>
                        </div>
                      </div>
                    </div>
                    <div class="table-responsive items-menu-table"></div>
                    <div class="d-block d-md-block mt-2">
                      <button class="btn-custom btn-close-items-menu-left" onclick="clearItemSlots(1);">{% trans 'Очистить слот' %}</button>
                      <button class="btn-custom btn-close-items-menu-right"
                        onclick="slot_switcher(1, this.parentElement.parentElement);">{% trans 'Закрыть' %}</button>
                    </div>
                  </div>
                </div>
                <div class="slot-container">
                  <div class="iconlarge paperdoll-hidden" data-env="live" data-tree="live" data-game="wow" data-character-slot="2">
                    <ins style="background-image: url(&quot;https://wow.zamimg.com/images/wow/icons/large/inventoryslot_neck.jpg&quot;);" class=""></ins>
                    <del></del>
                    <a href="javascript:"></a>
                  </div>
                  <div class="items-menu items-menu-left-up">
                    <div class="d-block d-md-block mb-2">
                      <div class="dressing-room-character-controls-category-option" data-character-customization-type="item_type"
                        style="align-items: center; justify-content: center;">
                        <a class="btn dress-btn fa fa-square first-btn-wow poor-wow" href="javascript:" tabindex="-1" data-quality="0"></a>
                        <a class="btn dress-btn fa fa-square medium-btn-wow common-wow" href="javascript:" tabindex="-1" data-quality="1"></a>
                        <a class="btn dress-btn fa fa-square medium-btn-wow uncommon-wow" href="javascript:" tabindex="-1" data-quality="2"></a>
                        <a class="btn dress-btn fa fa-square medium-btn-wow rare-wow" href="javascript:" tabindex="-1" data-quality="3"></a>
                        <a class="btn dress-btn fa fa-check-square medium-btn-wow epic-wow" href="javascript:" tabindex="-1" data-quality="4"></a>
                        <a class="btn dress-btn fa fa-square medium-btn-wow legendary-wow" href="javascript:" tabindex="-1" data-quality="5"></a>
                        <a class="btn dress-btn fa fa-square last-btn-wow heirloom-wow" href="javascript:" tabindex="-1" data-quality="7"></a>
                        <div tabindex="0" data-role="control" data-disabled="false" id="select_item_type_btn" style="padding-right: 2px;">
                          <a class="btn dress-btn fa fa-caret-left" href="javascript:" tabindex="-1"></a>
                          <a class="imitation-select" data-field-filled="true" href="javascript:" tabindex="-1"></a>
                          <a class="btn dress-btn fa fa-caret-right" href="javascript:" tabindex="-1"></a>
                        </div>
                      </div>
                    </div>
                    <div class="table-responsive items-menu-table"></div>
                    <div class="d-block d-md-block mt-2">
                      <button class="btn-custom btn-close-items-menu-left" onclick="clearItemSlots(2);">{% trans 'Очистить слот' %}</button>
                      <button class="btn-custom btn-close-items-menu-right"
                        onclick="slot_switcher(2, this.parentElement.parentElement);">{% trans 'Закрыть' %}</button>
                    </div>
                  </div>
                </div>
                <div class="slot-container">
                  <div class="iconlarge" data-env="live" data-tree="live" data-game="wow" data-character-slot="3">
                    <ins style="background-image: url(&quot;https://wow.zamimg.com/images/wow/icons/large/inventoryslot_shoulder.jpg&quot;);" class=""></ins>
                    <del></del>
                    <a href="javascript:"></a>
                  </div>
                  <div class="items-menu items-menu-left-up">
                    <div class="d-block d-md-block mb-2">
                      <div class="dressing-room-character-controls-category-option" data-character-customization-type="item_type"
                        style="align-items: center; justify-content: center;">
                        <a class="btn dress-btn fa fa-square first-btn-wow poor-wow" href="javascript:" tabindex="-1" data-quality="0"></a>
                        <a class="btn dress-btn fa fa-square medium-btn-wow common-wow" href="javascript:" tabindex="-1" data-quality="1"></a>
                        <a class="btn dress-btn fa fa-square medium-btn-wow uncommon-wow" href="javascript:" tabindex="-1" data-quality="2"></a>
                        <a class="btn dress-btn fa fa-square medium-btn-wow rare-wow" href="javascript:" tabindex="-1" data-quality="3"></a>
                        <a class="btn dress-btn fa fa-check-square medium-btn-wow epic-wow" href="javascript:" tabindex="-1" data-quality="4"></a>
                        <a class="btn dress-btn fa fa-square medium-btn-wow legendary-wow" href="javascript:" tabindex="-1" data-quality="5"></a>
                        <a class="btn dress-btn fa fa-square last-btn-wow heirloom-wow" href="javascript:" tabindex="-1" data-quality="7"></a>
                        <div tabindex="0" data-role="control" data-disabled="false" id="select_item_type_btn" style="padding-right: 2px;">
                          <a class="btn dress-btn fa fa-caret-left" href="javascript:" tabindex="-1"></a>
                          <a class="imitation-select" data-field-filled="true" href="javascript:" tabindex="-1"></a>
                          <a class="btn dress-btn fa fa-caret-right" href="javascript:" tabindex="-1"></a>
                        </div>
                      </div>
                    </div>
                    <div class="table-responsive items-menu-table"></div>
                    <div class="d-block d-md-block mt-2">
                      <button class="btn-custom btn-close-items-menu-left" onclick="clearItemSlots(3);">{% trans 'Очистить слот' %}</button>
                      <button class="btn-custom btn-close-items-menu-right"
                        onclick="slot_switcher(3, this.parentElement.parentElement);">{% trans 'Закрыть' %}</button>
                    </div>
                  </div>
                </div>
                <div class="slot-container">
                  <div class="iconlarge" data-env="live" data-tree="live" data-game="wow" data-character-slot="16">
                    <ins style="background-image: url(&quot;https://wow.zamimg.com/images/wow/icons/large/inventoryslot_chest.jpg&quot;);" class=""></ins>
                    <del></del>
                    <a href="javascript:"></a>
                  </div>
                  <div class="items-menu items-menu-left-up">
                    <div class="d-block d-md-block mb-2">
                      <div class="dressing-room-character-controls-category-option" data-character-customization-type="item_type"
                        style="align-items: center; justify-content: center;">
                        <a class="btn dress-btn fa fa-square first-btn-wow poor-wow" href="javascript:" tabindex="-1" data-quality="0"></a>
                        <a class="btn dress-btn fa fa-square medium-btn-wow common-wow" href="javascript:" tabindex="-1" data-quality="1"></a>
                        <a class="btn dress-btn fa fa-square medium-btn-wow uncommon-wow" href="javascript:" tabindex="-1" data-quality="2"></a>
                        <a class="btn dress-btn fa fa-square medium-btn-wow rare-wow" href="javascript:" tabindex="-1" data-quality="3"></a>
                        <a class="btn dress-btn fa fa-check-square medium-btn-wow epic-wow" href="javascript:" tabindex="-1" data-quality="4"></a>
                        <a class="btn dress-btn fa fa-square medium-btn-wow legendary-wow" href="javascript:" tabindex="-1" data-quality="5"></a>
                        <a class="btn dress-btn fa fa-square last-btn-wow heirloom-wow" href="javascript:" tabindex="-1" data-quality="7"></a>
                        <div tabindex="0" data-role="control" data-disabled="false" id="select_item_type_btn" style="padding-right: 2px;">
                          <a class="btn dress-btn fa fa-caret-left" href="javascript:" tabindex="-1"></a>
                          <a class="imitation-select" data-field-filled="true" href="javascript:" tabindex="-1"></a>
                          <a class="btn dress-btn fa fa-caret-right" href="javascript:" tabindex="-1"></a>
                        </div>
                      </div>
                    </div>
                    <div class="table-responsive items-menu-table"></div>
                    <div class="d-block d-md-block mt-2">
                      <button class="btn-custom btn-close-items-menu-left" onclick="clearItemSlots(16);">{% trans 'Очистить слот' %}</button>
                      <button class="btn-custom btn-close-items-menu-right"
                        onclick="slot_switcher(16, this.parentElement.parentElement);">{% trans 'Закрыть' %}</button>
                    </div>
                  </div>
                </div>
                <div class="slot-container">
                  <div class="iconlarge" data-env="live" data-tree="live" data-game="wow" data-character-slot="5">
                    <ins style="background-image: url(&quot;https://wow.zamimg.com/images/wow/icons/large/inventoryslot_chest.jpg&quot;);" class=""></ins>
                    <del></del>
                    <a href="javascript:"></a>
                  </div>
                  <div class="items-menu items-menu-left-down">
                    <div class="d-block d-md-block mb-2">
                      <div class="dressing-room-character-controls-category-option" data-character-customization-type="item_type"
                        style="align-items: center; justify-content: center;">
                        <a class="btn dress-btn fa fa-square first-btn-wow poor-wow" href="javascript:" tabindex="-1" data-quality="0"></a>
                        <a class="btn dress-btn fa fa-square medium-btn-wow common-wow" href="javascript:" tabindex="-1" data-quality="1"></a>
                        <a class="btn dress-btn fa fa-square medium-btn-wow uncommon-wow" href="javascript:" tabindex="-1" data-quality="2"></a>
                        <a class="btn dress-btn fa fa-square medium-btn-wow rare-wow" href="javascript:" tabindex="-1" data-quality="3"></a>
                        <a class="btn dress-btn fa fa-check-square medium-btn-wow epic-wow" href="javascript:" tabindex="-1" data-quality="4"></a>
                        <a class="btn dress-btn fa fa-square medium-btn-wow legendary-wow" href="javascript:" tabindex="-1" data-quality="5"></a>
                        <a class="btn dress-btn fa fa-square last-btn-wow heirloom-wow" href="javascript:" tabindex="-1" data-quality="7"></a>
                        <div tabindex="0" data-role="control" data-disabled="false" id="select_item_type_btn" style="padding-right: 2px;">
                          <a class="btn dress-btn fa fa-caret-left" href="javascript:" tabindex="-1"></a>
                          <a class="imitation-select" data-field-filled="true" href="javascript:" tabindex="-1"></a>
                          <a class="btn dress-btn fa fa-caret-right" href="javascript:" tabindex="-1"></a>
                        </div>
                      </div>
                    </div>
                    <div class="table-responsive items-menu-table"></div>
                    <div class="d-block d-md-block mt-2">
                      <button class="btn-custom btn-close-items-menu-left" onclick="clearItemSlots(5);">{% trans 'Очистить слот' %}</button>
                      <button class="btn-custom btn-close-items-menu-right"
                        onclick="slot_switcher(5, this.parentElement.parentElement);">{% trans 'Закрыть' %}</button>
                    </div>
                  </div>
                </div>
                <div class="slot-container">
                  <div class="iconlarge" data-env="live" data-tree="live" data-game="wow" data-character-slot="4">
                    <ins style="background-image: url(&quot;https://wow.zamimg.com/images/wow/icons/large/inventoryslot_shirt.jpg&quot;);" class=""></ins>
                    <del></del>
                    <a href="javascript:"></a>
                  </div>
                  <div class="items-menu items-menu-left-down">
                    <div class="d-block d-md-block mb-2">
                      <div class="dressing-room-character-controls-category-option" data-character-customization-type="item_type"
                        style="align-items: center; justify-content: center;">
                        <a class="btn dress-btn fa fa-square first-btn-wow poor-wow" href="javascript:" tabindex="-1" data-quality="0"></a>
                        <a class="btn dress-btn fa fa-square medium-btn-wow common-wow" href="javascript:" tabindex="-1" data-quality="1"></a>
                        <a class="btn dress-btn fa fa-square medium-btn-wow uncommon-wow" href="javascript:" tabindex="-1" data-quality="2"></a>
                        <a class="btn dress-btn fa fa-square medium-btn-wow rare-wow" href="javascript:" tabindex="-1" data-quality="3"></a>
                        <a class="btn dress-btn fa fa-check-square medium-btn-wow epic-wow" href="javascript:" tabindex="-1" data-quality="4"></a>
                        <a class="btn dress-btn fa fa-square medium-btn-wow legendary-wow" href="javascript:" tabindex="-1" data-quality="5"></a>
                        <a class="btn dress-btn fa fa-square last-btn-wow heirloom-wow" href="javascript:" tabindex="-1" data-quality="7"></a>
                        <div tabindex="0" data-role="control" data-disabled="false" id="select_item_type_btn" style="padding-right: 2px;">
                          <a class="btn dress-btn fa fa-caret-left" href="javascript:" tabindex="-1"></a>
                          <a class="imitation-select" data-field-filled="true" href="javascript:" tabindex="-1"></a>
                          <a class="btn dress-btn fa fa-caret-right" href="javascript:" tabindex="-1"></a>
                        </div>
                      </div>
                    </div>
                    <div class="table-responsive items-menu-table"></div>
                    <div class="d-block d-md-block mt-2">
                      <button class="btn-custom btn-close-items-menu-left" onclick="clearItemSlots(4);">{% trans 'Очистить слот' %}</button>
                      <button class="btn-custom btn-close-items-menu-right"
                        onclick="slot_switcher(4, this.parentElement.parentElement);">{% trans 'Закрыть' %}</button>
                    </div>
                  </div>
                </div>
                <div class="slot-container">
                  <div class="iconlarge" data-env="live" data-tree="live" data-game="wow" data-character-slot="19">
                    <ins style="background-image: url(&quot;https://wow.zamimg.com/images/wow/icons/large/inventoryslot_tabard.jpg&quot;);" class=""></ins>
                    <del></del>
                    <a href="javascript:"></a>
                  </div>
                  <div class="items-menu items-menu-left-down">
                    <div class="d-block d-md-block mb-2">
                      <div class="dressing-room-character-controls-category-option" data-character-customization-type="item_type"
                        style="align-items: center; justify-content: center;">
                        <a class="btn dress-btn fa fa-square first-btn-wow poor-wow" href="javascript:" tabindex="-1" data-quality="0"></a>
                        <a class="btn dress-btn fa fa-square medium-btn-wow common-wow" href="javascript:" tabindex="-1" data-quality="1"></a>
                        <a class="btn dress-btn fa fa-square medium-btn-wow uncommon-wow" href="javascript:" tabindex="-1" data-quality="2"></a>
                        <a class="btn dress-btn fa fa-square medium-btn-wow rare-wow" href="javascript:" tabindex="-1" data-quality="3"></a>
                        <a class="btn dress-btn fa fa-check-square medium-btn-wow epic-wow" href="javascript:" tabindex="-1" data-quality="4"></a>
                        <a class="btn dress-btn fa fa-square medium-btn-wow legendary-wow" href="javascript:" tabindex="-1" data-quality="5"></a>
                        <a class="btn dress-btn fa fa-square last-btn-wow heirloom-wow" href="javascript:" tabindex="-1" data-quality="7"></a>
                        <div tabindex="0" data-role="control" data-disabled="false" id="select_item_type_btn" style="padding-right: 2px;">
                          <a class="btn dress-btn fa fa-caret-left" href="javascript:" tabindex="-1"></a>
                          <a class="imitation-select" data-field-filled="true" href="javascript:" tabindex="-1"></a>
                          <a class="btn dress-btn fa fa-caret-right" href="javascript:" tabindex="-1"></a>
                        </div>
                      </div>
                    </div>
                    <div class="table-responsive items-menu-table"></div>
                    <div class="d-block d-md-block mt-2">
                      <button class="btn-custom btn-close-items-menu-left" onclick="clearItemSlots(19);">{% trans 'Очистить слот' %}</button>
                      <button class="btn-custom btn-close-items-menu-right"
                        onclick="slot_switcher(19, this.parentElement.parentElement);">{% trans 'Закрыть' %}</button>
                    </div>
                  </div>
                </div>
                <div class="slot-container">
                  <div class="iconlarge" data-env="live" data-tree="live" data-game="wow" data-character-slot="9">
                    <ins style="background-image: url(&quot;https://wow.zamimg.com/images/wow/icons/large/inventoryslot_wrists.jpg&quot;);" class=""></ins>
                    <del></del>
                    <a href="javascript:"></a>
                  </div>
                  <div class="items-menu items-menu-left-down items-menu-left-down-crutch">
                    <div class="d-block d-md-block mb-2">
                      <div class="dressing-room-character-controls-category-option" data-character-customization-type="item_type"
                        style="align-items: center; justify-content: center;">
                        <a class="btn dress-btn fa fa-square first-btn-wow poor-wow" href="javascript:" tabindex="-1" data-quality="0"></a>
                        <a class="btn dress-btn fa fa-square medium-btn-wow common-wow" href="javascript:" tabindex="-1" data-quality="1"></a>
                        <a class="btn dress-btn fa fa-square medium-btn-wow uncommon-wow" href="javascript:" tabindex="-1" data-quality="2"></a>
                        <a class="btn dress-btn fa fa-square medium-btn-wow rare-wow" href="javascript:" tabindex="-1" data-quality="3"></a>
                        <a class="btn dress-btn fa fa-check-square medium-btn-wow epic-wow" href="javascript:" tabindex="-1" data-quality="4"></a>
                        <a class="btn dress-btn fa fa-square medium-btn-wow legendary-wow" href="javascript:" tabindex="-1" data-quality="5"></a>
                        <a class="btn dress-btn fa fa-square last-btn-wow heirloom-wow" href="javascript:" tabindex="-1" data-quality="7"></a>
                        <div tabindex="0" data-role="control" data-disabled="false" id="select_item_type_btn" style="padding-right: 2px;">
                          <a class="btn dress-btn fa fa-caret-left" href="javascript:" tabindex="-1"></a>
                          <a class="imitation-select" data-field-filled="true" href="javascript:" tabindex="-1"></a>
                          <a class="btn dress-btn fa fa-caret-right" href="javascript:" tabindex="-1"></a>
                        </div>
                      </div>
                    </div>
                    <div class="table-responsive items-menu-table"></div>
                    <div class="d-block d-md-block mt-2">
                      <button class="btn-custom btn-close-items-menu-left" onclick="clearItemSlots(9);">{% trans 'Очистить слот' %}</button>
                      <button class="btn-custom btn-close-items-menu-right"
                        onclick="slot_switcher(9, this.parentElement.parentElement);">{% trans 'Закрыть' %}</button>
                    </div>
                  </div>
                </div>
              </div>

              <div class="paperdoll-right">
                <div class="slot-container">
                  <div class="iconlarge" data-env="live" data-tree="live" data-game="wow" data-character-slot="10">
                    <ins style="background-image: url(&quot;https://wow.zamimg.com/images/wow/icons/large/inventoryslot_hands.jpg&quot;);" class=""></ins>
                    <del></del>
                    <a href="javascript:"></a>
                  </div>
                  <div class="items-menu items-menu-right-up">
                    <div class="d-block d-md-block mb-2">
                      <div class="dressing-room-character-controls-category-option" data-character-customization-type="item_type"
                        style="align-items: center; justify-content: center;">
                        <a class="btn dress-btn fa fa-square first-btn-wow poor-wow" href="javascript:" tabindex="-1" data-quality="0"></a>
                        <a class="btn dress-btn fa fa-square medium-btn-wow common-wow" href="javascript:" tabindex="-1" data-quality="1"></a>
                        <a class="btn dress-btn fa fa-square medium-btn-wow uncommon-wow" href="javascript:" tabindex="-1" data-quality="2"></a>
                        <a class="btn dress-btn fa fa-square medium-btn-wow rare-wow" href="javascript:" tabindex="-1" data-quality="3"></a>
                        <a class="btn dress-btn fa fa-check-square medium-btn-wow epic-wow" href="javascript:" tabindex="-1" data-quality="4"></a>
                        <a class="btn dress-btn fa fa-square medium-btn-wow legendary-wow" href="javascript:" tabindex="-1" data-quality="5"></a>
                        <a class="btn dress-btn fa fa-square last-btn-wow heirloom-wow" href="javascript:" tabindex="-1" data-quality="7"></a>
                        <div tabindex="0" data-role="control" data-disabled="false" id="select_item_type_btn" style="padding-right: 2px;">
                          <a class="btn dress-btn fa fa-caret-left" href="javascript:" tabindex="-1"></a>
                          <a class="imitation-select" data-field-filled="true" href="javascript:" tabindex="-1"></a>
                          <a class="btn dress-btn fa fa-caret-right" href="javascript:" tabindex="-1"></a>
                        </div>
                      </div>
                    </div>
                    <div class="table-responsive items-menu-table"></div>
                    <div class="d-block d-md-block mt-2">
                      <button class="btn-custom btn-close-items-menu-left" onclick="clearItemSlots(10);">{% trans 'Очистить слот' %}</button>
                      <button class="btn-custom btn-close-items-menu-right"
                        onclick="slot_switcher(10, this.parentElement.parentElement);">{% trans 'Закрыть' %}</button>
                    </div>
                  </div>
                </div>
                <div class="slot-container">
                  <div class="iconlarge" data-env="live" data-tree="live" data-game="wow" data-character-slot="6">
                    <ins style="background-image: url(&quot;https://wow.zamimg.com/images/wow/icons/large/inventoryslot_waist.jpg&quot;);" class=""></ins>
                    <del></del>
                    <a href="javascript:"></a>
                  </div>
                  <div class="items-menu items-menu-right-up">
                    <div class="d-block d-md-block mb-2">
                      <div class="dressing-room-character-controls-category-option" data-character-customization-type="item_type"
                        style="align-items: center; justify-content: center;">
                        <a class="btn dress-btn fa fa-square first-btn-wow poor-wow" href="javascript:" tabindex="-1" data-quality="0"></a>
                        <a class="btn dress-btn fa fa-square medium-btn-wow common-wow" href="javascript:" tabindex="-1" data-quality="1"></a>
                        <a class="btn dress-btn fa fa-square medium-btn-wow uncommon-wow" href="javascript:" tabindex="-1" data-quality="2"></a>
                        <a class="btn dress-btn fa fa-square medium-btn-wow rare-wow" href="javascript:" tabindex="-1" data-quality="3"></a>
                        <a class="btn dress-btn fa fa-check-square medium-btn-wow epic-wow" href="javascript:" tabindex="-1" data-quality="4"></a>
                        <a class="btn dress-btn fa fa-square medium-btn-wow legendary-wow" href="javascript:" tabindex="-1" data-quality="5"></a>
                        <a class="btn dress-btn fa fa-square last-btn-wow heirloom-wow" href="javascript:" tabindex="-1" data-quality="7"></a>
                        <div tabindex="0" data-role="control" data-disabled="false" id="select_item_type_btn" style="padding-right: 2px;">
                          <a class="btn dress-btn fa fa-caret-left" href="javascript:" tabindex="-1"></a>
                          <a class="imitation-select" data-field-filled="true" href="javascript:" tabindex="-1"></a>
                          <a class="btn dress-btn fa fa-caret-right" href="javascript:" tabindex="-1"></a>
                        </div>
                      </div>
                    </div>
                    <div class="table-responsive items-menu-table"></div>
                    <div class="d-block d-md-block mt-2">
                      <button class="btn-custom btn-close-items-menu-left" onclick="clearItemSlots(6);">{% trans 'Очистить слот' %}</button>
                      <button class="btn-custom btn-close-items-menu-right"
                        onclick="slot_switcher(6, this.parentElement.parentElement);">{% trans 'Закрыть' %}</button>
                    </div>
                  </div>
                </div>
                <div class="slot-container">
                  <div class="iconlarge" data-env="live" data-tree="live" data-game="wow" data-character-slot="7">
                    <ins style="background-image: url(&quot;https://wow.zamimg.com/images/wow/icons/large/inventoryslot_legs.jpg&quot;);" class=""></ins>
                    <del></del>
                    <a href="javascript:"></a>
                  </div>
                  <div class="items-menu items-menu-right-up">
                    <div class="d-block d-md-block mb-2">
                      <div class="dressing-room-character-controls-category-option" data-character-customization-type="item_type"
                        style="align-items: center; justify-content: center;">
                        <a class="btn dress-btn fa fa-square first-btn-wow poor-wow" href="javascript:" tabindex="-1" data-quality="0"></a>
                        <a class="btn dress-btn fa fa-square medium-btn-wow common-wow" href="javascript:" tabindex="-1" data-quality="1"></a>
                        <a class="btn dress-btn fa fa-square medium-btn-wow uncommon-wow" href="javascript:" tabindex="-1" data-quality="2"></a>
                        <a class="btn dress-btn fa fa-square medium-btn-wow rare-wow" href="javascript:" tabindex="-1" data-quality="3"></a>
                        <a class="btn dress-btn fa fa-check-square medium-btn-wow epic-wow" href="javascript:" tabindex="-1" data-quality="4"></a>
                        <a class="btn dress-btn fa fa-square medium-btn-wow legendary-wow" href="javascript:" tabindex="-1" data-quality="5"></a>
                        <a class="btn dress-btn fa fa-square last-btn-wow heirloom-wow" href="javascript:" tabindex="-1" data-quality="7"></a>
                        <div tabindex="0" data-role="control" data-disabled="false" id="select_item_type_btn" style="padding-right: 2px;">
                          <a class="btn dress-btn fa fa-caret-left" href="javascript:" tabindex="-1"></a>
                          <a class="imitation-select" data-field-filled="true" href="javascript:" tabindex="-1"></a>
                          <a class="btn dress-btn fa fa-caret-right" href="javascript:" tabindex="-1"></a>
                        </div>
                      </div>
                    </div>
                    <div class="table-responsive items-menu-table"></div>
                    <div class="d-block d-md-block mt-2">
                      <button class="btn-custom btn-close-items-menu-left" onclick="clearItemSlots(7);">{% trans 'Очистить слот' %}</button>
                      <button class="btn-custom btn-close-items-menu-right"
                        onclick="slot_switcher(7, this.parentElement.parentElement);">{% trans 'Закрыть' %}</button>
                    </div>
                  </div>
                </div>
                <div class="slot-container">
                  <div class="iconlarge" data-env="live" data-tree="live" data-game="wow" data-character-slot="8">
                    <ins style="background-image: url(&quot;https://wow.zamimg.com/images/wow/icons/large/inventoryslot_feet.jpg&quot;);" class=""></ins>
                    <del></del>
                    <a href="javascript:"></a>
                  </div>
                  <div class="items-menu items-menu-right-up">
                    <div class="d-block d-md-block mb-2">
                      <div class="dressing-room-character-controls-category-option" data-character-customization-type="item_type"
                        style="align-items: center; justify-content: center;">
                        <a class="btn dress-btn fa fa-square first-btn-wow poor-wow" href="javascript:" tabindex="-1" data-quality="0"></a>
                        <a class="btn dress-btn fa fa-square medium-btn-wow common-wow" href="javascript:" tabindex="-1" data-quality="1"></a>
                        <a class="btn dress-btn fa fa-square medium-btn-wow uncommon-wow" href="javascript:" tabindex="-1" data-quality="2"></a>
                        <a class="btn dress-btn fa fa-square medium-btn-wow rare-wow" href="javascript:" tabindex="-1" data-quality="3"></a>
                        <a class="btn dress-btn fa fa-check-square medium-btn-wow epic-wow" href="javascript:" tabindex="-1" data-quality="4"></a>
                        <a class="btn dress-btn fa fa-square medium-btn-wow legendary-wow" href="javascript:" tabindex="-1" data-quality="5"></a>
                        <a class="btn dress-btn fa fa-square last-btn-wow heirloom-wow" href="javascript:" tabindex="-1" data-quality="7"></a>
                        <div tabindex="0" data-role="control" data-disabled="false" id="select_item_type_btn" style="padding-right: 2px;">
                          <a class="btn dress-btn fa fa-caret-left" href="javascript:" tabindex="-1"></a>
                          <a class="imitation-select" data-field-filled="true" href="javascript:" tabindex="-1"></a>
                          <a class="btn dress-btn fa fa-caret-right" href="javascript:" tabindex="-1"></a>
                        </div>
                      </div>
                    </div>
                    <div class="table-responsive items-menu-table"></div>
                    <div class="d-block d-md-block mt-2">
                      <button class="btn-custom btn-close-items-menu-left" onclick="clearItemSlots(8);">{% trans 'Очистить слот' %}</button>
                      <button class="btn-custom btn-close-items-menu-right"
                        onclick="slot_switcher(8, this.parentElement.parentElement);">{% trans 'Закрыть' %}</button>
                    </div>
                  </div>
                </div>
                <div class="slot-container">
                  <div class="iconlarge paperdoll-hidden" data-env="live" data-tree="live" data-game="wow" data-character-slot="11">
                    <ins style="background-image: url(&quot;https://wow.zamimg.com/images/wow/icons/large/inventoryslot_finger.jpg&quot;);" class=""></ins>
                    <del></del>
                    <a href="javascript:"></a>
                  </div>
                  <div class="items-menu items-menu-right-down">
                    <div class="d-block d-md-block mb-2">
                      <div class="dressing-room-character-controls-category-option" data-character-customization-type="item_type"
                        style="align-items: center; justify-content: center;">
                        <a class="btn dress-btn fa fa-square first-btn-wow poor-wow" href="javascript:" tabindex="-1" data-quality="0"></a>
                        <a class="btn dress-btn fa fa-square medium-btn-wow common-wow" href="javascript:" tabindex="-1" data-quality="1"></a>
                        <a class="btn dress-btn fa fa-square medium-btn-wow uncommon-wow" href="javascript:" tabindex="-1" data-quality="2"></a>
                        <a class="btn dress-btn fa fa-square medium-btn-wow rare-wow" href="javascript:" tabindex="-1" data-quality="3"></a>
                        <a class="btn dress-btn fa fa-check-square medium-btn-wow epic-wow" href="javascript:" tabindex="-1" data-quality="4"></a>
                        <a class="btn dress-btn fa fa-square medium-btn-wow legendary-wow" href="javascript:" tabindex="-1" data-quality="5"></a>
                        <a class="btn dress-btn fa fa-square last-btn-wow heirloom-wow" href="javascript:" tabindex="-1" data-quality="7"></a>
                        <div tabindex="0" data-role="control" data-disabled="false" id="select_item_type_btn" style="padding-right: 2px;">
                          <a class="btn dress-btn fa fa-caret-left" href="javascript:" tabindex="-1"></a>
                          <a class="imitation-select" data-field-filled="true" href="javascript:" tabindex="-1"></a>
                          <a class="btn dress-btn fa fa-caret-right" href="javascript:" tabindex="-1"></a>
                        </div>
                      </div>
                    </div>
                    <div class="table-responsive items-menu-table"></div>
                    <div class="d-block d-md-block mt-2">
                      <button class="btn-custom btn-close-items-menu-left" onclick="clearItemSlots(11);">{% trans 'Очистить слот' %}</button>
                      <button class="btn-custom btn-close-items-menu-right"
                        onclick="slot_switcher(11, this.parentElement.parentElement);">{% trans 'Закрыть' %}</button>
                    </div>
                  </div>
                </div>
                <div class="slot-container">
                  <div class="iconlarge paperdoll-hidden" data-env="live" data-tree="live" data-game="wow" data-character-slot="12">
                    <ins style="background-image: url(&quot;https://wow.zamimg.com/images/wow/icons/large/inventoryslot_finger.jpg&quot;);" class=""></ins>
                    <del></del>
                    <a href="javascript:"></a>
                  </div>
                  <div class="items-menu items-menu-right-down">
                    <div class="d-block d-md-block mb-2">
                      <div class="dressing-room-character-controls-category-option" data-character-customization-type="item_type"
                        style="align-items: center; justify-content: center;">
                        <a class="btn dress-btn fa fa-square first-btn-wow poor-wow" href="javascript:" tabindex="-1" data-quality="0"></a>
                        <a class="btn dress-btn fa fa-square medium-btn-wow common-wow" href="javascript:" tabindex="-1" data-quality="1"></a>
                        <a class="btn dress-btn fa fa-square medium-btn-wow uncommon-wow" href="javascript:" tabindex="-1" data-quality="2"></a>
                        <a class="btn dress-btn fa fa-square medium-btn-wow rare-wow" href="javascript:" tabindex="-1" data-quality="3"></a>
                        <a class="btn dress-btn fa fa-check-square medium-btn-wow epic-wow" href="javascript:" tabindex="-1" data-quality="4"></a>
                        <a class="btn dress-btn fa fa-square medium-btn-wow legendary-wow" href="javascript:" tabindex="-1" data-quality="5"></a>
                        <a class="btn dress-btn fa fa-square last-btn-wow heirloom-wow" href="javascript:" tabindex="-1" data-quality="7"></a>
                        <div tabindex="0" data-role="control" data-disabled="false" id="select_item_type_btn" style="padding-right: 2px;">
                          <a class="btn dress-btn fa fa-caret-left" href="javascript:" tabindex="-1"></a>
                          <a class="imitation-select" data-field-filled="true" href="javascript:" tabindex="-1"></a>
                          <a class="btn dress-btn fa fa-caret-right" href="javascript:" tabindex="-1"></a>
                        </div>
                      </div>
                    </div>
                    <div class="table-responsive items-menu-table"></div>
                    <div class="d-block d-md-block mt-2">
                      <button class="btn-custom btn-close-items-menu-left" onclick="clearItemSlots(12);">{% trans 'Очистить слот' %}</button>
                      <button class="btn-custom btn-close-items-menu-right"
                        onclick="slot_switcher(12, this.parentElement.parentElement);">{% trans 'Закрыть' %}</button>
                    </div>
                  </div>
                </div>
                <div class="slot-container">
                  <div class="iconlarge paperdoll-hidden" data-env="live" data-tree="live" data-game="wow" data-character-slot="13">
                    <ins style="background-image: url(&quot;https://wow.zamimg.com/images/wow/icons/large/inventoryslot_trinket.jpg&quot;);" class=""></ins>
                    <del></del>
                    <a href="javascript:"></a>
                  </div>
                  <div class="items-menu items-menu-right-down">
                    <div class="d-block d-md-block mb-2">
                      <div class="dressing-room-character-controls-category-option" data-character-customization-type="item_type"
                        style="align-items: center; justify-content: center;">
                        <a class="btn dress-btn fa fa-square first-btn-wow poor-wow" href="javascript:" tabindex="-1" data-quality="0"></a>
                        <a class="btn dress-btn fa fa-square medium-btn-wow common-wow" href="javascript:" tabindex="-1" data-quality="1"></a>
                        <a class="btn dress-btn fa fa-square medium-btn-wow uncommon-wow" href="javascript:" tabindex="-1" data-quality="2"></a>
                        <a class="btn dress-btn fa fa-square medium-btn-wow rare-wow" href="javascript:" tabindex="-1" data-quality="3"></a>
                        <a class="btn dress-btn fa fa-check-square medium-btn-wow epic-wow" href="javascript:" tabindex="-1" data-quality="4"></a>
                        <a class="btn dress-btn fa fa-square medium-btn-wow legendary-wow" href="javascript:" tabindex="-1" data-quality="5"></a>
                        <a class="btn dress-btn fa fa-square last-btn-wow heirloom-wow" href="javascript:" tabindex="-1" data-quality="7"></a>
                        <div tabindex="0" data-role="control" data-disabled="false" id="select_item_type_btn" style="padding-right: 2px;">
                          <a class="btn dress-btn fa fa-caret-left" href="javascript:" tabindex="-1"></a>
                          <a class="imitation-select" data-field-filled="true" href="javascript:" tabindex="-1"></a>
                          <a class="btn dress-btn fa fa-caret-right" href="javascript:" tabindex="-1"></a>
                        </div>
                      </div>
                    </div>
                    <div class="table-responsive items-menu-table"></div>
                    <div class="d-block d-md-block mt-2">
                      <button class="btn-custom btn-close-items-menu-left" onclick="clearItemSlots(13);">{% trans 'Очистить слот' %}</button>
                      <button class="btn-custom btn-close-items-menu-right"
                        onclick="slot_switcher(13, this.parentElement.parentElement);">{% trans 'Закрыть' %}</button>
                    </div>
                  </div>
                </div>
                <div class="slot-container">
                  <div class="iconlarge paperdoll-hidden" data-env="live" data-tree="live" data-game="wow" data-character-slot="14">
                    <ins style="background-image: url(&quot;https://wow.zamimg.com/images/wow/icons/large/inventoryslot_trinket.jpg&quot;);" class=""></ins>
                    <del></del>
                    <a href="javascript:"></a>
                  </div>
                  <div class="items-menu items-menu-right-down">
                    <div class="d-block d-md-block mb-2">
                      <div class="dressing-room-character-controls-category-option" data-character-customization-type="item_type"
                        style="align-items: center; justify-content: center;">
                        <a class="btn dress-btn fa fa-square first-btn-wow poor-wow" href="javascript:" tabindex="-1" data-quality="0"></a>
                        <a class="btn dress-btn fa fa-square medium-btn-wow common-wow" href="javascript:" tabindex="-1" data-quality="1"></a>
                        <a class="btn dress-btn fa fa-square medium-btn-wow uncommon-wow" href="javascript:" tabindex="-1" data-quality="2"></a>
                        <a class="btn dress-btn fa fa-square medium-btn-wow rare-wow" href="javascript:" tabindex="-1" data-quality="3"></a>
                        <a class="btn dress-btn fa fa-check-square medium-btn-wow epic-wow" href="javascript:" tabindex="-1" data-quality="4"></a>
                        <a class="btn dress-btn fa fa-square medium-btn-wow legendary-wow" href="javascript:" tabindex="-1" data-quality="5"></a>
                        <a class="btn dress-btn fa fa-square last-btn-wow heirloom-wow" href="javascript:" tabindex="-1" data-quality="7"></a>
                        <div tabindex="0" data-role="control" data-disabled="false" id="select_item_type_btn" style="padding-right: 2px;">
                          <a class="btn dress-btn fa fa-caret-left" href="javascript:" tabindex="-1"></a>
                          <a class="imitation-select" data-field-filled="true" href="javascript:" tabindex="-1"></a>
                          <a class="btn dress-btn fa fa-caret-right" href="javascript:" tabindex="-1"></a>
                        </div>
                      </div>
                    </div>
                    <div class="table-responsive items-menu-table"></div>
                    <div class="d-block d-md-block mt-2">
                      <button class="btn-custom btn-close-items-menu-left" onclick="clearItemSlots(14);">{% trans 'Очистить слот' %}</button>
                      <button class="btn-custom btn-close-items-menu-right"
                        onclick="slot_switcher(14, this.parentElement.parentElement);">{% trans 'Закрыть' %}</button>
                    </div>
                  </div>
                </div>
              </div>

              <div class="paperdoll-bottom">

                <div class="slot-container" style="display: inline-block;">
                  <div class="iconlarge paperdoll-enchant" data-env="live" data-tree="live" data-game="wow" data-character-slot="021"
                    style="display: inline-block; position: relative; z-index: 1; transform-origin: right;">
                    <ins class="" style="background-image: url(&quot;https://wow.zamimg.com/images/wow/icons/large/inventoryslot_enchant.jpg&quot;);"></ins>
                    <del></del>
                    <a href="javascript:"></a>
                  </div>
                  <div class="items-menu items-menu-bottom-left-enchant">
                    <div class="d-block d-md-block mb-2" style="display: none !important;">
                      <div class="dressing-room-character-controls-category-option" data-character-customization-type="item_type"
                        style="align-items: center; justify-content: center;">
                        <a class="btn dress-btn fa fa-square first-btn-wow poor-wow" href="javascript:" tabindex="-1" data-quality="0"></a>
                        <a class="btn dress-btn fa fa-square medium-btn-wow common-wow" href="javascript:" tabindex="-1" data-quality="1"></a>
                        <a class="btn dress-btn fa fa-square medium-btn-wow uncommon-wow" href="javascript:" tabindex="-1" data-quality="2"></a>
                        <a class="btn dress-btn fa fa-square medium-btn-wow rare-wow" href="javascript:" tabindex="-1" data-quality="3"></a>
                        <a class="btn dress-btn fa fa-check-square medium-btn-wow epic-wow" href="javascript:" tabindex="-1" data-quality="4"></a>
                        <a class="btn dress-btn fa fa-square medium-btn-wow legendary-wow" href="javascript:" tabindex="-1" data-quality="5"></a>
                        <a class="btn dress-btn fa fa-square last-btn-wow heirloom-wow" href="javascript:" tabindex="-1" data-quality="7"></a>
                        <div tabindex="0" data-role="control" data-disabled="false" id="select_item_type_btn" style="padding-right: 2px;">
                          <a class="btn dress-btn fa fa-caret-left" href="javascript:" tabindex="-1"></a>
                          <a class="imitation-select" data-field-filled="true" href="javascript:" tabindex="-1"></a>
                          <a class="btn dress-btn fa fa-caret-right" href="javascript:" tabindex="-1"></a>
                        </div>
                      </div>
                    </div>
                    <div class="table-responsive items-menu-table"></div>
                    <div class="d-block d-md-block mt-2">
                      <button class="btn-custom btn-close-items-menu-left" onclick="clearItemSlots('021');">{% trans 'Очистить слот' %}</button>
                      <button class="btn-custom btn-close-items-menu-right"
                        onclick="slot_switcher('021', this.parentElement.parentElement);">{% trans 'Закрыть' %}</button>
                    </div>
                  </div>
                </div>

                <div class="slot-container" style="display: inline-block;">
                  <div class="iconlarge" data-env="live" data-tree="live" data-game="wow" data-character-slot="21"
                    style="display: inline-block; position: relative; z-index: 1;">
                    <ins style="background-image: url(&quot;https://wow.zamimg.com/images/wow/icons/large/inventoryslot_mainhand.jpg&quot;);" class=""></ins>
                    <del></del>
                    <a href="javascript:"></a>
                  </div>
                  <div class="items-menu items-menu-bottom-left">
                    <div class="d-block d-md-block mb-2">
                      <div class="dressing-room-character-controls-category-option" data-character-customization-type="item_type"
                        style="align-items: center; justify-content: center;">
                        <a class="btn dress-btn fa fa-square first-btn-wow poor-wow" href="javascript:" tabindex="-1" data-quality="0"></a>
                        <a class="btn dress-btn fa fa-square medium-btn-wow common-wow" href="javascript:" tabindex="-1" data-quality="1"></a>
                        <a class="btn dress-btn fa fa-square medium-btn-wow uncommon-wow" href="javascript:" tabindex="-1" data-quality="2"></a>
                        <a class="btn dress-btn fa fa-square medium-btn-wow rare-wow" href="javascript:" tabindex="-1" data-quality="3"></a>
                        <a class="btn dress-btn fa fa-check-square medium-btn-wow epic-wow" href="javascript:" tabindex="-1" data-quality="4"></a>
                        <a class="btn dress-btn fa fa-square medium-btn-wow legendary-wow" href="javascript:" tabindex="-1" data-quality="5"></a>
                        <a class="btn dress-btn fa fa-square last-btn-wow heirloom-wow" href="javascript:" tabindex="-1" data-quality="7"></a>
                        <div tabindex="0" data-role="control" data-disabled="false" id="select_item_type_btn" style="padding-right: 2px;">
                          <a class="btn dress-btn fa fa-caret-left" href="javascript:" tabindex="-1"></a>
                          <a class="imitation-select" data-field-filled="true" href="javascript:" tabindex="-1"></a>
                          <a class="btn dress-btn fa fa-caret-right" href="javascript:" tabindex="-1"></a>
                        </div>
                      </div>
                    </div>
                    <div class="table-responsive items-menu-table"></div>
                    <div class="d-block d-md-block mt-2">
                      <button class="btn-custom btn-close-items-menu-left" onclick="clearItemSlots(21);">{% trans 'Очистить слот' %}</button>
                      <button class="btn-custom btn-close-items-menu-right"
                        onclick="slot_switcher(21, this.parentElement.parentElement);">{% trans 'Закрыть' %}</button>
                    </div>
                  </div>
                </div>
                <div class="slot-container" style="display: inline-block;">
                  <div class="iconlarge" data-env="live" data-tree="live" data-game="wow" data-character-slot="22"
                    style="display: inline-block; position: relative; z-index: 1;">
                    <ins style="background-image: url(&quot;https://wow.zamimg.com/images/wow/icons/large/inventoryslot_offhand.jpg&quot;);" class=""></ins>
                    <del></del>
                    <a href="javascript:"></a>
                  </div>
                  <div class="items-menu items-menu-bottom-center">
                    <div class="d-block d-md-block mb-2">
                      <div class="dressing-room-character-controls-category-option" data-character-customization-type="item_type"
                        style="align-items: center; justify-content: center;">
                        <a class="btn dress-btn fa fa-square first-btn-wow poor-wow" href="javascript:" tabindex="-1" data-quality="0"></a>
                        <a class="btn dress-btn fa fa-square medium-btn-wow common-wow" href="javascript:" tabindex="-1" data-quality="1"></a>
                        <a class="btn dress-btn fa fa-square medium-btn-wow uncommon-wow" href="javascript:" tabindex="-1" data-quality="2"></a>
                        <a class="btn dress-btn fa fa-square medium-btn-wow rare-wow" href="javascript:" tabindex="-1" data-quality="3"></a>
                        <a class="btn dress-btn fa fa-check-square medium-btn-wow epic-wow" href="javascript:" tabindex="-1" data-quality="4"></a>
                        <a class="btn dress-btn fa fa-square medium-btn-wow legendary-wow" href="javascript:" tabindex="-1" data-quality="5"></a>
                        <a class="btn dress-btn fa fa-square last-btn-wow heirloom-wow" href="javascript:" tabindex="-1" data-quality="7"></a>
                        <div tabindex="0" data-role="control" data-disabled="false" id="select_item_type_btn" style="padding-right: 2px;">
                          <a class="btn dress-btn fa fa-caret-left" href="javascript:" tabindex="-1"></a>
                          <a class="imitation-select" data-field-filled="true" href="javascript:" tabindex="-1"></a>
                          <a class="btn dress-btn fa fa-caret-right" href="javascript:" tabindex="-1"></a>
                        </div>
                      </div>
                    </div>
                    <div class="table-responsive items-menu-table"></div>
                    <div class="d-block d-md-block mt-2">
                      <button class="btn-custom btn-close-items-menu-left" onclick="clearItemSlots(22);">{% trans 'Очистить слот' %}</button>
                      <button class="btn-custom btn-close-items-menu-right"
                        onclick="slot_switcher(22, this.parentElement.parentElement);">{% trans 'Закрыть' %}</button>
                    </div>
                  </div>
                </div>
                <div class="slot-container" style="display: inline-block;">
                  <div class="iconlarge" data-env="live" data-tree="live" data-game="wow" data-character-slot="23"
                    style="display: inline-block; position: relative; z-index: 1;">
                    <ins style="background-image: url(&quot;https://wow.zamimg.com/images/wow/icons/large/inventoryslot_ranged.jpg&quot;);" class=""></ins>
                    <del></del>
                    <a href="javascript:"></a>
                  </div>
                  <div class="items-menu items-menu-bottom-right">
                    <div class="d-block d-md-block mb-2">
                      <div class="dressing-room-character-controls-category-option" data-character-customization-type="item_type"
                        style="align-items: center; justify-content: center;">
                        <a class="btn dress-btn fa fa-square first-btn-wow poor-wow" href="javascript:" tabindex="-1" data-quality="0"></a>
                        <a class="btn dress-btn fa fa-square medium-btn-wow common-wow" href="javascript:" tabindex="-1" data-quality="1"></a>
                        <a class="btn dress-btn fa fa-square medium-btn-wow uncommon-wow" href="javascript:" tabindex="-1" data-quality="2"></a>
                        <a class="btn dress-btn fa fa-square medium-btn-wow rare-wow" href="javascript:" tabindex="-1" data-quality="3"></a>
                        <a class="btn dress-btn fa fa-check-square medium-btn-wow epic-wow" href="javascript:" tabindex="-1" data-quality="4"></a>
                        <a class="btn dress-btn fa fa-square medium-btn-wow legendary-wow" href="javascript:" tabindex="-1" data-quality="5"></a>
                        <a class="btn dress-btn fa fa-square last-btn-wow heirloom-wow" href="javascript:" tabindex="-1" data-quality="7"></a>
                        <div tabindex="0" data-role="control" data-disabled="false" id="select_item_type_btn" style="padding-right: 2px;">
                          <a class="btn dress-btn fa fa-caret-left" href="javascript:" tabindex="-1"></a>
                          <a class="imitation-select" data-field-filled="true" href="javascript:" tabindex="-1"></a>
                          <a class="btn dress-btn fa fa-caret-right" href="javascript:" tabindex="-1"></a>
                        </div>
                      </div>
                    </div>
                    <div class="table-responsive items-menu-table"></div>
                    <div class="d-block d-md-block mt-2">
                      <button class="btn-custom btn-close-items-menu-left" onclick="clearItemSlots(23);">{% trans 'Очистить слот' %}</button>
                      <button class="btn-custom btn-close-items-menu-right"
                        onclick="slot_switcher(23, this.parentElement.parentElement);">{% trans 'Закрыть' %}</button>
                    </div>
                  </div>
                </div>

                <div class="slot-container" style="display: inline-block;">
                  <div class="iconlarge paperdoll-enchant" data-env="live" data-tree="live" data-game="wow" data-character-slot="022"
                    style="display: inline-block; position: relative; z-index: 1; transform-origin: left;">
                    <ins class="" style="background-image: url(&quot;https://wow.zamimg.com/images/wow/icons/large/inventoryslot_enchant.jpg&quot;);"></ins>
                    <del></del>
                    <a href="javascript:"></a>
                  </div>
                  <div class="items-menu items-menu-bottom-right-enchant">
                    <div class="d-block d-md-block mb-2" style="display: none !important;">
                      <div class="dressing-room-character-controls-category-option" data-character-customization-type="item_type"
                        style="align-items: center; justify-content: center;">
                        <a class="btn dress-btn fa fa-square first-btn-wow poor-wow" href="javascript:" tabindex="-1" data-quality="0"></a>
                        <a class="btn dress-btn fa fa-square medium-btn-wow common-wow" href="javascript:" tabindex="-1" data-quality="1"></a>
                        <a class="btn dress-btn fa fa-square medium-btn-wow uncommon-wow" href="javascript:" tabindex="-1" data-quality="2"></a>
                        <a class="btn dress-btn fa fa-square medium-btn-wow rare-wow" href="javascript:" tabindex="-1" data-quality="3"></a>
                        <a class="btn dress-btn fa fa-check-square medium-btn-wow epic-wow" href="javascript:" tabindex="-1" data-quality="4"></a>
                        <a class="btn dress-btn fa fa-square medium-btn-wow legendary-wow" href="javascript:" tabindex="-1" data-quality="5"></a>
                        <a class="btn dress-btn fa fa-square last-btn-wow heirloom-wow" href="javascript:" tabindex="-1" data-quality="7"></a>
                        <div tabindex="0" data-role="control" data-disabled="false" id="select_item_type_btn" style="padding-right: 2px;">
                          <a class="btn dress-btn fa fa-caret-left" href="javascript:" tabindex="-1"></a>
                          <a class="imitation-select" data-field-filled="true" href="javascript:" tabindex="-1"></a>
                          <a class="btn dress-btn fa fa-caret-right" href="javascript:" tabindex="-1"></a>
                        </div>
                      </div>
                    </div>
                    <div class="table-responsive items-menu-table"></div>
                    <div class="d-block d-md-block mt-2">
                      <button class="btn-custom btn-close-items-menu-left" onclick="clearItemSlots('022');">{% trans 'Очистить слот' %}</button>
                      <button class="btn-custom btn-close-items-menu-right"
                        onclick="slot_switcher('022', this.parentElement.parentElement);">{% trans 'Закрыть' %}</button>
                    </div>
                  </div>
                </div>

              </div>

              <div class="paperdoll-model">
                <!-- style="border: 1px solid rgba(255, 255, 255, 0.5);"> -->
                <div class="paperdoll-model-inner" id="paperdoll-model-dressing-room-paperdoll"></div>
              </div>

              <div class="paperdoll-responsive-shell">
                <div class="paperdoll-responsive-expander"></div>
              </div>

              <div class="warning-toast-message">
                <span class="warning-toast-message-icon">⚠️</span>
                <br>
                <div class="warning-toast-message-text"></div>
              </div>

            </div>

            <div class="dressing-room-character-controls-category-switchers">
              <a data-category="gear" id="gear_button" href="javascript:" data-active="true" class=""></a>
              <a data-category="character" id="character_button" href="javascript:" class=""></a>
              <a data-category="face" id="face_button" href="javascript:"></a>
              <a data-category="patch" id="change_game_patch" href="javascript:" style="background-image: url(/static/main_app/images/wrath.png)"></a>
            </div>

            <div class="dressing-room-character-controls-category" id="dressing-room-face-settings" data-category="face" style="pointer-events: none;">
              <h2 class="heading-size-2">{% trans 'Внешность' %}</h2>
            </div>

            <div class="dressing-room-character-controls-category" id="dressing-room-character-settings" data-category="character">
              <h2 class="heading-size-2">{% trans 'Персонаж' %}</h2>
              <div class="dressing-room-character-controls-category-option" data-character-customization-type="___race">
                <div data-role="label">{% trans 'Раса' %}</div>
                <div tabindex="0" data-role="control" id="select_race_btn">
                  <a class="btn dress-btn fa fa-caret-left" href="javascript:" tabindex="-1"></a>
                  <a class="imitation-select" data-field-filled="true" href="javascript:" tabindex="-1" style="pointer-events: all;"></a>
                  <a class="btn dress-btn fa fa-caret-right" href="javascript:" tabindex="-1"></a>
                </div>

                <div class="items-menu races-menu">
                  <div class="table-responsive items-menu-table races-menu-table"></div>
                  <div class="d-block d-md-block mt-2" style="line-height: 0px;">
                    <button class="btn-custom btn-close-items-menu-right"
                      onclick="races_menu_switcher(this.parentElement.parentElement);">{% trans 'Закрыть' %}</button>
                  </div>
                </div>

              </div>
              <div class="dressing-room-character-controls-category-option" data-character-customization-type="gender">
                <div data-role="label">{% trans 'Пол' %}</div>
                <div tabindex="0" data-role="control" id="select_gender_btn">
                  <a class="btn dress-btn fa fa-caret-left" href="javascript:" tabindex="-1"></a>
                  <a class="imitation-select" data-field-filled="true" href="javascript:" tabindex="-1"></a>
                  <a class="btn dress-btn fa fa-caret-right" href="javascript:" tabindex="-1"></a>
                </div>
              </div>
              <div class="dressing-room-character-controls-category-option" data-character-customization-type="sheathed">
                <div data-role="label">{% trans 'Оружие' %}</div>
                <div tabindex="0" data-role="control" id="select_sheathed_btn">
                  <a class="btn dress-btn fa fa-caret-left" href="javascript:" tabindex="-1"></a>
                  <a class="imitation-select" data-field-filled="true" href="javascript:" tabindex="-1"></a>
                  <a class="btn dress-btn fa fa-caret-right" href="javascript:" tabindex="-1"></a>
                </div>
              </div>
              <div class="dressing-room-character-controls-category-option" data-character-customization-type="animation">
                <div data-role="label">{% trans 'Анимация' %}</div>
                <div tabindex="0" data-role="control" data-disabled="false" id="select_animation_btn">
                  <a class="btn dress-btn fa fa-caret-left" href="javascript:" tabindex="-1"></a>
                  <a class="imitation-select" data-field-filled="true" href="javascript:" tabindex="-1" style="pointer-events: all;"></a>
                  <a class="btn dress-btn fa fa-caret-right" href="javascript:" tabindex="-1"></a>
                </div>

                <div class="items-menu anims-menu">
                  <div class="table-responsive items-menu-table anims-menu-table"></div>
                  <div class="d-block d-md-block mt-2" style="line-height: 0px;">
                    <button class="btn-custom btn-close-items-menu-left"
                      onclick="checkDuplicateAnim(window.dressUI.char.default_anim);">{% trans 'Сбросить анимацию' %}</button>
                    <button class="btn-custom btn-close-items-menu-right"
                      onclick="anims_menu_switcher(this.parentElement.parentElement);">{% trans 'Закрыть' %}</button>
                  </div>
                </div>

              </div>
              <div class="dressing-room-character-controls-category-option" data-character-customization-type="mount">
                <div data-role="label">{% trans 'Маунт' %}</div>
                <div tabindex="0" data-role="control" data-disabled="false" id="select_mount_btn">
                  <a class="btn dress-btn fa fa-caret-left" href="javascript:" tabindex="-1"></a>
                  <a class="imitation-select" data-field-filled="true" href="javascript:" tabindex="-1" style="pointer-events: all;"></a>
                  <a class="btn dress-btn fa fa-caret-right" href="javascript:" tabindex="-1"></a>
                </div>

                <div class="items-menu mounts-menu">

                  <div class="close-mounts-menu-top-up">
                    <button class="btn dress-btn btn-site fa fa-times close-mounts-menu-btn" type="button"
                      onclick="mounts_menu_switcher(this.parentElement.parentElement);">
                      <span style="font-size: 14px;">{% trans 'Закрыть' %}</span>
                    </button>
                  </div>

                  <div class="listview-scroller-horizontal">
                    <div class="listview-scroller-vertical">
                      <div class="listview-mode-tiled clickable" style="font-size: 14px; font-weight: bold;">
                        <div class="screenshot-cell" index="0">
                          <div class="screenshot-caption-wrapper" style="margin-top: 65px;">
                            <div class="screenshot-caption">
                              <a class="q7">None</a>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="d-block d-md-block mt-2" style="line-height: 0px;">
                    <button class="btn-custom btn-close-items-menu-left" onclick="checkDuplicateMount(0);">{% trans 'Убрать маунта' %}</button>
                    <button class="btn-custom btn-close-items-menu-right"
                      onclick="mounts_menu_switcher(this.parentElement.parentElement);">{% trans 'Закрыть' %}</button>
                  </div>
                </div>

              </div>
              <div class="dressing-room-character-controls-category-option" data-character-customization-type="only-item">
                <div data-role="label">
                  <label for="only-item">{% trans 'Только итем' %}</label>
                </div>
                <div data-role="control">
                  <input type="checkbox" name="only-item" id="only-item" data-field-filled="true">
                </div>
              </div>
            </div>

            <div class="dressing-room-character-controls-general">
              <button class="btn dress-btn btn-site fa fa-eye-slash" id="dr-toggle-ui" type="button">{% trans 'Скрыть' %} UI</button>
              <button class="btn dress-btn btn-site fa fa-pause" id="dr-pause" type="button">{% trans 'Пауза' %}</button>
              <button class="btn dress-btn btn-site fa fa-camera" id="dr-screenshot" type="button">{% trans 'Скриншот' %}</button>

              <a _ngcontent-xpp-c94="" class="info">
                <button class="btn dress-btn btn-site fa fa-times" id="dr-reset" type="button">{% trans 'Сброс' %}</button>
                <span _ngcontent-xpp-c94="" class="info-text"
                  style="color: #fff; margin-top: -93px; margin-left: -200px;">{% trans 'Сбросить позицию и анимацию персонажа' %}</span>
              </a>

              <a _ngcontent-xpp-c94="" class="info">
                <button class="btn dress-btn btn-site fa fa-random" id="dr-randomize" type="button">{% trans 'Рандом' %}</button>
                <span _ngcontent-xpp-c94="" class="info-text"
                  style="color: #fff; margin-top: -93px; margin-left: -285px;">{% trans 'Сгенерировать случайные настройки персонажа' %}</span>
              </a>

              <a _ngcontent-xpp-c94="" class="info">
                <button class="btn dress-btn btn-site fa fa-link" id="dr-links" type="button"
                  onclick="copy_text.copy(document.location.href);">{% trans 'Ссылка' %}</button>
                <span _ngcontent-xpp-c94="" class="info-text"
                  style="color: #fff; margin-top: -93px; margin-left: -75px;">{% trans 'Скопировать ссылку на комнату' %}</span>
              </a>

              <button class="btn dress-btn btn-site fa fa-list-ol" id="dr-my-saved-rooms" type="button">{% trans 'Комнаты' %}</button>

              <!-- <button class="btn dress-btn btn-site fa fa-undo" id="dr-undo" type="button">Undo</button>
              <button class="btn dress-btn btn-site fa fa-repeat" id="dr-redo" type="button" disabled="">Redo</button> -->
            </div>

          </div>
        </div>

        <script>
          const modelIsLoaded = function(func, ignoreUserRights=false) {
            return function(...args) {
              // проверяет есть ли у пользователя разрешение на редактирование персонажа
              if (!ignoreUserRights && !window.dressUI.room_creator && !window.dressUI.allow_edit) {
                warnMessageHandler(3000, "{% trans 'Создатель этой комнаты запретил изменение персонажа другими пользователями.' %}");
                return false;
              // проверяет, была ли создана модель.
              } else if (!window.model) {
                warnMessageHandler(4000, "{% trans 'Ошибка, модель не была создана.' %}");
                return false;
              // проверяет, полностью ли загружена модель.
              } else if (!window.model.renderer || !window.model.renderer.models[0].modelIsLoaded
                        || !window.model.renderer.viewer.method("isLoaded")) {
                warnMessageHandler(2000, "{% trans 'Пожалуйста, дождитесь полной загрузки модели.' %}");
                return false;
              } else if (!window.gameData) {
                warnMessageHandler(2000, "{% trans 'Пожалуйста, дождитесь полной загрузки базы данных.' %}");
                return false;
              };
              func.apply(this, args);
            };
          };
        </script>

        <script>
          const warning_toast_message = $('.warning-toast-message');

          const warnMessageHandler = function(duration, message) {
            warning_toast_message.stop(true, true);

            warning_toast_message.find('div').text(message);
            warning_toast_message.css('display', 'block');

            warning_toast_message.animate(
              { opacity: 0 },
              { duration: duration, queue: false,
                complete: function() {
                  warning_toast_message.css('opacity', '1');
                  warning_toast_message.css('display', 'none');
                }
              }
            );
          };
        </script>

        <script>
          const my_saved_rooms_container = $('.my-saved-rooms-container')[0];
          const my_saved_rooms = $('.my-saved-rooms')[0];

          function generateRoomsListHtml() {
            if (!charData.my_saved_rooms || charData.my_saved_rooms.length === 0) {
              my_saved_rooms.textContent = "{% trans 'У вас нету ни одной сохранённой комнаты.' %}";
            } else {
              for (const roomData of charData.my_saved_rooms) {

                const race = ALL_RACES[roomData.race].toLowerCase();
                const gender = GENDERS[roomData.gender].toLowerCase();

                const race_gender_img_url = RACES_WITHOUT_ICON.indexOf(roomData.race) !== -1
                ? '/static/main_app/images/close.png'
                : `${DEFAULT_ICON_URL}race_${race}_${gender}.jpg`;

                const element_char_img = document.createElement('img');
                element_char_img.setAttribute('src', race_gender_img_url);
                element_char_img.classList.add('rooms-list-img');

                const element_patch_img = document.createElement('img');
                element_patch_img.setAttribute('src', `/static/main_app/images/${roomData.game_patch}.png`);
                element_patch_img.classList.add('rooms-list-img');
                element_patch_img.textContent = roomData.game_patch;

                const element_user_icon = document.createElement('div');
                element_user_icon.classList.add('fa');
                roomData.allow_edit ? element_user_icon.classList.add('fa-users') : element_user_icon.classList.add('fa-user');
                element_user_icon.style.display = 'inline-block';
                element_user_icon.style.fontSize = '23px';
                element_user_icon.style.marginRight = '5px';

                const element_span = document.createElement('span');
                element_span.textContent = ' ' + roomData.last_update_time;
                element_span.style.fontSize = '15px';

                const element_calendar_icon = document.createElement('div');
                element_calendar_icon.classList.add('fa', 'fa-calendar');
                element_calendar_icon.style.display = 'inline-block';
                element_calendar_icon.style.fontSize = '21px';
                element_calendar_icon.style.position = 'relative';
                element_calendar_icon.style.bottom = '1px';
                element_calendar_icon.appendChild(element_span);

                const element_a = document.createElement('a');
                // element_a.setAttribute('href', window.location.href.split('/').slice(0, -2).join('/') + '/' + roomData.room_id);
                element_a.setAttribute('href', window.location.origin + "{% url 'dressing_room' %}" + roomData.room_id);
                element_a.setAttribute('target', '_BLANK');
                element_a.classList.add('rooms-list-link');
                element_a.appendChild(element_char_img);
                element_a.appendChild(element_patch_img);
                element_a.appendChild(element_user_icon);
                element_a.appendChild(element_calendar_icon);

                my_saved_rooms.appendChild(element_a);
              };
            };
          };
          generateRoomsListHtml();


          $('#dr-my-saved-rooms').on('click', function(event) {
            window.dressUI.saved_rooms = !window.dressUI.saved_rooms;
            my_saved_rooms_container.style.display = window.dressUI.saved_rooms ? 'grid' : 'none';
          });


          $('#change_game_patch').on('click', modelIsLoaded(function(event) {
            window.dressUI.game_patch = window.dressUI.game_patch === 'wrath' ? 'live' : 'wrath';
            event.target.style.backgroundImage = `url(/static/main_app/images/${window.dressUI.game_patch}.png)`;

            if (window.dressUI.game_patch === 'wrath' && window.dressUI.model_opts.race > WRATH_RACES_LEN) {
              window.dressUI.model_opts.race = WRATH_RACES_LEN;
            };
            if (window.dressUI.game_patch === 'wrath' && window.dressUI.char.mount > WRATH_MOUNTS_LEN) {
              window.dressUI.char.mount = WRATH_MOUNTS_LEN;
            };

            // может возникать проблема при переключении патча и слишком быстрой перезагрузки страницы
            // изза этого происходит рассинхрон между патчем и количество настроек внешности для персонажа на этом патче
            sendAjaxRequest();

            // warnMessageHandler(6000, interpolate(gettext('Для изменения на %s патч, пожалуйста, перезагрузите страницу.\nВсе настройки внешности будут сброшены.'), [window.dressUI.game_patch.toUpperCase()]));
            // warnMessageHandler(6000, interpolate("{% blocktrans %}Для изменения на %s патч, пожалуйста, перезагрузите страницу.\nВсе настройки внешности будут сброшены.{% endblocktrans %}", [window.dressUI.game_patch.toUpperCase()]));
            warnMessageHandler(6000, interpolate("{% trans 'Для изменения на %s патч, пожалуйста, перезагрузите страницу.\nВсе настройки внешности будут сброшены.' %}", [window.dressUI.game_patch.toUpperCase()]));
          }));

          if (window.dressUI.game_patch === 'live') {
            $('#change_game_patch')[0].style.backgroundImage =
            `url(/static/main_app/images/${window.dressUI.game_patch}.png)`;
          };


          if (window.dressUI.room_creator) {
            $('.dressing-room-character-controls-general')[0].insertAdjacentHTML('beforeEnd',
              `<a _ngcontent-xpp-c94="" class="info">
                <button class="btn dress-btn btn-site fa fa-user" id="dr-allow-edit" type="button">{% trans 'Редакт' %}</button>
                <span _ngcontent-xpp-c94="" class="info-text" style="color: #fff; margin-top: -93px; margin-left: -230px;"></span>
              </a>`
            );

            const dr_allow_edit = $('#dr-allow-edit');
            dr_allow_edit.on('click', function(event) {
              window.dressUI.allow_edit = !window.dressUI.allow_edit;
              setAllowEditIcon();
              window.dressUI.allow_edit
              ? warnMessageHandler(4000, "{% trans 'Теперь другие пользователи смогут редактировать персонажа на этой странице.' %}")
              : warnMessageHandler(4000, "{% trans 'Теперь только у вас есть право редактировать персонажа на этой странице.' %}");
            });

            function setAllowEditIcon() {
              if (window.dressUI.allow_edit) {
                dr_allow_edit[0].classList.remove('fa-user');
                dr_allow_edit[0].classList.add('fa-users');
                dr_allow_edit[0].parentElement.children[1].textContent = "{% trans 'Запретить редактирование другим пользователям' %}";
              } else {
                dr_allow_edit[0].classList.remove('fa-users');
                dr_allow_edit[0].classList.add('fa-user');
                dr_allow_edit[0].parentElement.children[1].textContent = "{% trans 'Разрешить редактирование другим пользователям' %}";
              };
            };
            setAllowEditIcon();
          };
        </script>

        <script>
          const sortItemsFunc = (a, b) => {
            if (a.getAttribute('ilvl') == b.getAttribute('ilvl')) return -1;
          };

          function sortItems(items_menu, slot_data, arr=null) {
            if (!arr) {
              const slotItems = items_menu.children[1].getElementsByTagName("A");
              arr = Array.from(slotItems);
            };
            const sortedSlotItemsArray = arr.sort(sortItemsFunc);

            // sortedSlotItemsArray.forEach(element => {
            $(sortedSlotItemsArray).each(function(index, element) {

              if (element.getAttribute('type') == slot_data.type
              && element.getAttribute('quality') == slot_data.quality
              || element.getAttribute('visualId')) {
                element.style.display = 'block';
              } else {
                element.style.display = 'none';
              };

              items_menu.children[1].appendChild(element);
            });
            // items_menu.children[1].append(...arr);
          };


          function updateItemsMenuHandler(direction, slot_data, imit_select) {
            direction ? slot_data.index -= 1 : slot_data.index += 1;
            slot_data.type = slot_data.available_types[slot_data.index];
            imit_select.textContent = slot_data.type;
          };


          function clearItemSlotsIcon(...slotIds) {
            for (const slotId of slotIds) {
              let slot_btn = getSlotBtnBySlotId(slotId);
              let ins = slot_btn.children[0];

              ins.style.backgroundImage = `url(${DEFAULT_ICON_URL}${DEFAULT_SLOT_ICONS[slotId]}.jpg)`;
              slot_btn.children[2].href = 'javascript:';

              removeUnderlineFrom_A(slot_btn.parentElement.children[1].children[1].children[0]);
            };
          };


          function setItemSlotIcon(element, slot_btn) {
            let ins = slot_btn.children[0];
            const icon = element.children[0].children[0].style.backgroundImage.split('/').pop().split('.')[0];
            const itemId = element.href.split('=').pop();

            ins.style.backgroundImage = `url(${DEFAULT_ICON_URL}${icon}.jpg)`;
            slot_btn.children[2].href = `${WH_TOOLTIP_URL}item=${itemId}`;
          };


          function clearItemSlots(slotId) {

            if (window.dressUI.char.only_item) {
              warnMessageHandler(2000, "{% trans 'Отключено в режиме «Только итем».' %}");
              return false;
            };

            // console.log('clearItemSlots_before_clearSlots -> window.dressUI.model_opts.items:', ...window.dressUI.model_opts.items);

            if (slotId === '021' || slotId === '022') {
              const index = slotIdIsExists(parseInt(slotId));

              if (index === false || !window.dressUI.model_opts.items[index][3]) {
                warnMessageHandler(1500, "{% trans 'Выбранный слот уже пуст.' %}");
              } else {
                const displayId = window.dressUI.model_opts.items[index][1];
                window.model.renderer.viewer.method("setItems", [[
                  { slot: parseInt(slotId), display: displayId, visual: 0 }
                ]]);

                window.dressUI.model_opts.items[index].splice(3, 1, 0);
                clearItemSlotsIcon(slotId);
              };
              return false;
            };

            const index = slotIdIsExists(slotId);
            // если текущий slotId не записан в items тогда выходим из функции
            if (index === false) {
              warnMessageHandler(1500, "{% trans 'Выбранный слот уже пуст.' %}");
              return false;
            };
            // иначе удаляем итем из items
            window.dressUI.model_opts.items.splice(index, 1);

            clearItemSlotsIcon(slotId);

            switch (parseInt(slotId)) {
              case 21: clearItemSlotsIcon('021'); break;
              case 22: clearItemSlotsIcon('022'); break;
            };

            // Удалить итем с указанного айди слота
            window.model.renderer.viewer.method("clearSlots", slotId.toString());
            // удалить несколько итемов по айди слотов
            // передаётся строка в таком формате: "21,22" получается так: [21, 22].join()

            if (slotId == 21 || slotId == 22 || slotId == 23) updateSheathInfo();

            // console.log('clearItemSlots_after_clearSlots -> window.dressUI.model_opts.items:', ...window.dressUI.model_opts.items);
          };


          function setItemSlots(element_a) {
            const slot_btn = element_a.parentElement.parentElement.parentElement.children[0];
            let slotId = parseInt(slot_btn.getAttribute('data-character-slot'));
            let displayId = parseInt(element_a.getAttribute('display-id'));
            let itemId = parseInt(element_a.href.split('=').pop());
            let visualId = parseInt(element_a.getAttribute('visualId')) || 0;

            // Временная заглушка
            if (window.dressUI.char.only_item && slotId != 1 && slotId != 3 && slotId != 21 && slotId != 22 && slotId != 23) {
              warnMessageHandler(3000, "{% trans 'Для просмотра доступны только шлем, наплечье и слоты с оружием.' %}");
              return false;
            } else if (window.dressUI.char.only_item && visualId !== 0) {
              warnMessageHandler(3000, "{% trans 'В режиме «Только итем» зачарование оружия недоступно.' %}");
              return false;
            };

            // console.log('setItemSlots_before_setItems -> window.dressUI.model_opts.items:', ...window.dressUI.model_opts.items);

            let index = slotIdIsExists(slotId);

            if (visualId !== 0) {
              if (index !== false) {
                if (window.dressUI.model_opts.items[index][3] == visualId) {
                  // warnMessageHandler(1500, 'Надетый и выбранный итемы имеют одинаковые модели.');
                  return false;
                };
                displayId = window.dressUI.model_opts.items[index][1];
                itemId = window.dressUI.model_opts.items[index][2];
              } else {
                warnMessageHandler(2000, "{% trans 'Сначала возьмите в руку оружие.' %}");
                return false;
              };
            };

            if (!window.dressUI.char.only_item) {
              // если текущий slotId уже записан в items тогда
              if (index !== false) {
                // если текущий displayId равен записаному в items тогда выходим из функции
                if (window.dressUI.model_opts.items[index][1] == displayId && visualId === 0) {
                  // warnMessageHandler(1500, 'Надетый и выбранный итемы имеют одинаковые модели.');
                  return false;
                };
                // иначе обновляем displayId, itemId и visualId на новый
                window.dressUI.model_opts.items[index][1] = displayId;
                window.dressUI.model_opts.items[index][2] = itemId;
                if (visualId !== 0) window.dressUI.model_opts.items[index][3] = visualId;
              // иначе добавляем новый итем в items
              } else {
                window.dressUI.model_opts.items.push([slotId, displayId, itemId, visualId]);
              };

              switch (slotId) {
                case 22: if (slotIdIsExists(23) !== false) clearItemSlots(23); break;
                case 23: if (slotIdIsExists(22) !== false) clearItemSlots(22); clearItemSlotsIcon('022'); break;
              };

            } else {
              if (window.dressUI.char.only_item_data.id === displayId) {
                // warnMessageHandler(1500, 'Надетый и выбранный итемы имеют одинаковые модели.');
                return false;
              };
              window.dressUI.char.only_item_data =
              {type: TYPEID_BY_SLOTID[slotId], id: displayId, itemId: itemId, slotId: slotId};
            };

            removeUnderlineFrom_A(element_a);
            element_a.classList.add('text-uline');

            setItemSlotIcon(element_a, slot_btn);

            if (window.dressUI.char.only_item) {
              switch (slotId) {
                case 1: clearItemSlotsIcon(3, 21, 22, 23); break;
                case 3: clearItemSlotsIcon(1, 21, 22, 23); break;
                case 21: clearItemSlotsIcon(1, 3, 22, 23); break;
                case 22: clearItemSlotsIcon(1, 3, 21, 23); break;
                case 23: clearItemSlotsIcon(1, 3, 21, 22); break;
              };
              window.generateItemModel({type: TYPEID_BY_SLOTID[slotId], id: displayId});

            } else {
              window.model.renderer.viewer.method("clearSlots", slotId.toString());

              index = slotIdIsExists(slotId);

              // Установить итемы на модель (можно устанавливать несколько итемов за раз)
              window.model.renderer.viewer.method("setItems", [[
                { slot: slotId, display: displayId, visual: window.dressUI.model_opts.items[index][3] },
              ]]);

              if (slotId == 21 || slotId == 22 || slotId == 23) updateSheathInfo();

              // console.log('setItemSlots_after_setItems -> window.dressUI.model_opts.items:', ...window.dressUI.model_opts.items);
            };
          };


          function getSlotBtnBySlotId(slotId) {
            let toReturn;
            $('.iconlarge').each(function(index, slot_btn) {
              if (slotId.toString() === slot_btn.getAttribute('data-character-slot')) {
                toReturn = slot_btn;
                return false;
              };
            });
            return toReturn;
          };


          function slot_switcher(slotId, items_menu) {
            window.dressUI.gear.items_menu[`slot${slotId}`].opened = !window.dressUI.gear.items_menu[`slot${slotId}`].opened;
            window.dressUI.gear.items_menu[`slot${slotId}`].opened ? $(items_menu).css('display', 'block') : $(items_menu).css('display', 'none');
          };


          function removeUnderlineFrom_A(target) {
            for (let element of target.parentElement.getElementsByTagName("A")) {
              if (element.classList.contains('text-uline')) element.classList.remove('text-uline');
            };
          };


          function itemQualityCheckMarkUpdate(target) {
            for (let element of target.parentElement.getElementsByTagName("A")) {
              if (element.classList.contains('fa-check-square')) {
                element.classList.remove('fa-check-square');
                element.classList.add('fa-square');
              };
            };
            target.classList.add('fa-check-square');
          };


          function generateItemsMenuHtml(slotId) {
            let elements_list = [];

            if (slotId === '021' || slotId === '022') slotId = 'enchants';

            for (const itemData of window.gameData[0][slotId]) {

              const element_ins_icon = document.createElement('ins');
              element_ins_icon.style.backgroundImage = `url(${DEFAULT_ICON_URL}${itemData.icon}.jpg)`;

              const element_del_icon = document.createElement('del');

              const element_span_icon = document.createElement('span');
              element_span_icon.classList.add('iconlarge'); // iconsmall // iconmedium // iconlarge
              element_span_icon.appendChild(element_ins_icon);
              element_span_icon.appendChild(element_del_icon);

              const element_span_text = document.createElement('span');
              element_span_text.textContent = itemData.name;

              const element_a = document.createElement('a');
              if (slotId === 'enchants') {
                element_a.setAttribute('visualId', itemData.visualId);
                itemData.quality = 1;
              };
              element_a.classList.add(ITEM_QUALITIES[itemData.quality]);
              element_a.setAttribute('href', `${WH_TOOLTIP_URL}item=${itemData.itemId}`);
              element_a.setAttribute('display-id', itemData.displayId);
              element_a.setAttribute('quality', itemData.quality);
              element_a.setAttribute('type', itemData.type);
              element_a.setAttribute('ilvl', itemData.ilvl);
              element_a.appendChild(element_span_icon);
              element_a.appendChild(element_span_text);

              elements_list.push(element_a);
            };
            return elements_list;
          };


          function generateItemsMenu(slotId, items_menu) {

            const slot_data = window.dressUI.gear.items_menu[`slot${slotId}`];
            const item_types_len = slot_data.available_types.length - 1;
            const elements_list = generateItemsMenuHtml(slotId);

            setAlphaForExtremeButtonPosition(
              items_menu.getElementsByClassName("fa-caret-left")[0],
              0,
              item_types_len
            );

            items_menu.children[0].addEventListener('click', modelIsLoaded(function(event) {

              if (event.target.classList.contains('fa-caret-left') && slot_data.index > 0) {

                updateItemsMenuHandler(true, slot_data, event.target.parentElement.children[1]);
                sortItems(items_menu, slot_data);
                setAlphaForExtremeButtonPosition(event.target, slot_data.index, item_types_len);

              } else if (event.target.classList.contains('fa-caret-right') && slot_data.index < item_types_len) {

                updateItemsMenuHandler(false, slot_data, event.target.parentElement.children[1]);
                sortItems(items_menu, slot_data);
                setAlphaForExtremeButtonPosition(event.target, slot_data.index, item_types_len);
              };

              const quality = event.target.getAttribute('data-quality');
              if (quality && slot_data.quality != quality) {

                itemQualityCheckMarkUpdate(event.target);
                slot_data.quality = quality;
                sortItems(items_menu, slot_data);
              };
            }));

            items_menu.children[1].addEventListener('click', modelIsLoaded(function(event) {
              event.preventDefault(); // блокирует переход по ссылке но обрабатывает клик и отображает тултип
              if (event.target.tagName === 'SPAN') { setItemSlots(event.target.parentElement); }
              else if (event.target.tagName === 'A') { setItemSlots(event.target); };
            }));

            $(items_menu.children[0].children[0]).find('div')[0].children[1].textContent = slot_data.type;
            sortItems(items_menu, slot_data, elements_list);
          };


          function creatingItemsMenu() {
            const itemsMenus = document.querySelector('#dressing-room-paperdoll').getElementsByClassName('items-menu');
            for (const items_menu of itemsMenus) {
              const slotId = items_menu.parentElement.children[0].getAttribute('data-character-slot');
              if (slotId != 2 && slotId != 11 && slotId != 12 && slotId != 13 && slotId != 14) {
                generateItemsMenu(slotId, items_menu);
              };
            };
          };


          function slots_handler(event) {
            if (!event.target.parentElement.hasAttribute('data-character-slot')) return false;

            event.preventDefault(); // блокирует переход по ссылке но обрабатывает клик и отображает тултип

            const slotId = event.target.parentElement.getAttribute('data-character-slot');
            const items_menu = event.target.parentElement.parentElement.children[1];

            slot_switcher(slotId, items_menu);
          };


          $('.paperdoll-left a').on('click touchstart', modelIsLoaded(function(event) {
            slots_handler(event);
          }));


          $('.paperdoll-right a').on('click touchstart', modelIsLoaded(function(event) {
            slots_handler(event);
          }));


          $('.paperdoll-bottom a').on('click touchstart', modelIsLoaded(function(event) {
            slots_handler(event);
          }));
        </script>

        <script>
          function setDefaultText() {
            $('#select_race_btn').find('a')[1].textContent = RACES[window.dressUI.char.race_id];
            $('#select_gender_btn').find('a')[1].textContent = GENDERS[window.dressUI.char.gender_id];

            updateSheathText();

            $('#select_animation_btn').find('a')[1].textContent =
            window.dressUI.char.anims_list[window.dressUI.char.anim];

            $('#select_mount_btn').find('a')[1].textContent =
            window.gameData[0].mounts[window.dressUI.char.mount].name;
          };
        </script>

        <script>
          // Character HANDLERS

          $('#select_race_btn a').on('click', modelIsLoaded(function(event) {

            if (this.classList.contains('imitation-select')) {
              races_menu_switcher(event.target.parentElement.parentElement.children[2]);
              return false;
            };

            if (this.classList.contains('fa-caret-left') && window.dressUI.char.race_id > 1) {

              switch (window.dressUI.char.race_id) {
                case 24: window.dressUI.char.race_id -= 2; break;
                case 27: window.dressUI.char.race_id -= 3; break;
                default: window.dressUI.char.race_id -= 1;
              };
            } else if (this.classList.contains('fa-caret-right') && window.dressUI.char.race_id < RACES_LEN) {

              switch (window.dressUI.char.race_id) {
                case 22: window.dressUI.char.race_id += 2; break;
                case 24: window.dressUI.char.race_id += 3; break;
                default: window.dressUI.char.race_id += 1;
              };
            };
            setRace(window.dressUI.char.race_id);
          }));


          function getImgUrlByRaceId(race_id) {
            const race = RACES[race_id].toLowerCase();
            const gender = GENDERS[window.dressUI.char.gender_id].toLowerCase();

            const race_gender_img_url = RACES_WITHOUT_ICON.indexOf(parseInt(race_id)) !== -1
            ? '/static/main_app/images/close.png'
            : `${DEFAULT_ICON_URL}race_${race}_${gender}.jpg`;

            return race_gender_img_url;
          };

          function updateGenderImagesInRacesMenu() {
            const elements_a = races_menu.getElementsByTagName("A");

            for (let i=0; i < elements_a.length; i++) {

              const race_id = elements_a[i].getAttribute('race_id');
              elements_a[i].children[0].src = getImgUrlByRaceId(race_id);
            };
          };

          const races_menu = $('.races-menu')[0].children[0];

          function generateRacesMenuHtml() {

            for (const race_id in RACES) {

              const element_char_img = document.createElement('img');
              element_char_img.setAttribute('src', getImgUrlByRaceId(race_id));
              element_char_img.classList.add('races-menu-img');

              const element_span = document.createElement('span');
              element_span.textContent = RACES[race_id];
              element_span.style.fontSize = '15px';

              const element_a = document.createElement('a');
              element_a.setAttribute('href', 'javascript:');
              element_a.setAttribute('race_id', race_id);
              element_a.classList.add('q1');
              element_a.appendChild(element_char_img);
              element_a.appendChild(element_span);

              races_menu.appendChild(element_a);
            };

            races_menu.addEventListener('click', modelIsLoaded(function(event) {
              event.preventDefault(); // блокирует переход по ссылке но обрабатывает клик и отображает тултип

              if (event.target.tagName === 'A') {
                checkDuplicateRace(event.target.getAttribute('race_id'));
              } else if (event.target.tagName === 'IMG' || event.target.tagName === 'SPAN') {
                checkDuplicateRace(event.target.parentElement.getAttribute('race_id'));
              };
            }));
          };
          generateRacesMenuHtml();


          function checkDuplicateRace(current_index) {
            if (window.dressUI.model_opts.race == current_index) {
              // warnMessageHandler(1500, 'Текущая и выбранная раса одинаковая.');
              return false;
            };
            setRace(current_index);
          };


          function setRace(current_index) {
            window.dressUI.char.race_id = parseInt(current_index);
            window.dressUI.model_opts.race = window.dressUI.char.race_id;

            const current_element_a = findElementByRaceId(window.dressUI.model_opts.race);
            removeUnderlineFrom_A(current_element_a);
            current_element_a.classList.add('text-uline');

            const caret_element_a = $('#select_race_btn').find('a')[1];

            const anim_name = RACES[window.dressUI.model_opts.race];

            caret_element_a.textContent = anim_name;

            setAlphaForExtremeButtonPosition(
              caret_element_a,
              window.dressUI.model_opts.race,
              RACES_LEN,
              1
            );
            window.dressUI.face.current = [];
            window.generateCharModel();
          };


          function races_menu_switcher(races_menu) {
            window.dressUI.char.races_menu_opened = !window.dressUI.char.races_menu_opened;
            window.dressUI.char.races_menu_opened ? $(races_menu).css('display', 'block') : $(races_menu).css('display', 'none');
          };



          $('#select_gender_btn a').on('click', modelIsLoaded(function(event) {

            if (this.classList.contains('fa-caret-left') && window.dressUI.char.gender_id === 1) {

              window.dressUI.char.gender_id -= 1;

            } else if (this.classList.contains('fa-caret-right') && window.dressUI.char.gender_id === 0) {

              window.dressUI.char.gender_id += 1;
            };
            window.dressUI.model_opts.gender = window.dressUI.char.gender_id;
            setAlphaForExtremeButtonPosition(event.target, window.dressUI.char.gender_id, 1);
            event.target.parentElement.children[1].textContent = GENDERS[window.dressUI.char.gender_id];
            updateGenderImagesInRacesMenu();
            window.dressUI.face.current = [];
            window.generateCharModel();
          }));



          $('#select_sheathed_btn a').on('click', modelIsLoaded(function(event) {

            if (this.classList.contains('fa-caret-left')
            && window.dressUI.char.sheath > 0) {

              window.dressUI.char.sheath -= 1;

            } else if (this.classList.contains('fa-caret-right')
            && window.dressUI.char.sheath < window.dressUI.char.sheath_opts.length - 1) {

              window.dressUI.char.sheath += 1;
            };
            setSheath();
          }, true));

          function updateSheathText() {
            $('#select_sheathed_btn').find('a')[1].textContent = window.dressUI.char.sheath == 0
            ? 'Unsheathed'
            : `Sheathed-${window.dressUI.char.sheath}`;
            window.dressUI.model_opts.sheathMain = window.dressUI.char.sheath_opts[window.dressUI.char.sheath][0];
            window.dressUI.model_opts.sheathOff = window.dressUI.char.sheath_opts[window.dressUI.char.sheath][1];
          };

          function setSheath() {
            const sheath_opts_len = window.dressUI.char.sheath_opts.length - 1;
            window.dressUI.char.sheath = Math.min(window.dressUI.char.sheath, sheath_opts_len);

            updateSheathText();
            setAlphaForExtremeButtonPosition($('#select_sheathed_btn').find('a')[1], window.dressUI.char.sheath, sheath_opts_len);

            window.model.renderer.viewer.method("setSheath", window.dressUI.char.sheath_opts[window.dressUI.char.sheath]);
          };



          $('#select_animation_btn a').on('click', modelIsLoaded(function(event) {

            if (this.classList.contains('imitation-select')) {
              anims_menu_switcher(event.target.parentElement.parentElement.children[2]);
              return false;
            };

            if (this.classList.contains('fa-caret-left')
            && window.dressUI.char.anim > 0) {

              window.dressUI.char.anim -= 1;

            } else if (this.classList.contains('fa-caret-right')
            && window.dressUI.char.anim < window.dressUI.char.anims_list.length - 1) {

              window.dressUI.char.anim += 1;
            };
            setAnim(window.dressUI.char.anim);
          }, true));

          function generateAnimsMenuHtml() {
            const anims_menu = $('.anims-menu')[0].children[0];

            for (const i in window.dressUI.char.anims_list) {

              anims_menu.insertAdjacentHTML('beforeEnd',
                `
                <a class="q1" href="javascript:" index="${i}">${window.dressUI.char.anims_list[i]}</a>
                `
              );
            };

            anims_menu.addEventListener('click', modelIsLoaded(function(event) {
              event.preventDefault(); // блокирует переход по ссылке но обрабатывает клик и отображает тултип

              if (event.target.tagName === 'A') checkDuplicateAnim(event.target.getAttribute('index'));
            }, true));
          };

          function checkDuplicateAnim(current_index) {
            if (window.dressUI.char.anim == current_index) {
              // warnMessageHandler(1500, 'Текущая и выбранная анимация одинаковая.');
              return false;
            };
            setAnim(current_index);
          };


          function setAnim(current_index) {
            window.dressUI.char.anim = parseInt(current_index);

            const current_element_a = $('.anims-menu-table')[0].getElementsByTagName("A")[window.dressUI.char.anim];
            removeUnderlineFrom_A(current_element_a.parentElement);
            current_element_a.classList.add('text-uline');

            const caret_element_a = $('#select_animation_btn').find('a')[1];

            const anim_name = window.dressUI.char.anims_list[window.dressUI.char.anim];

            caret_element_a.textContent = anim_name;

            setAlphaForExtremeButtonPosition(
              caret_element_a,
              window.dressUI.char.anim,
              window.dressUI.char.anims_list.length - 1
            );

            window.model.renderer.viewer.method("setAnimation", anim_name);
            // window.model.renderer.viewer.method("resetAnimation"); // Отменить анимацию
          };

          function anims_menu_switcher(anims_menu) {
            window.dressUI.char.anims_menu_opened = !window.dressUI.char.anims_menu_opened;
            window.dressUI.char.anims_menu_opened ? $(anims_menu).css('display', 'block') : $(anims_menu).css('display', 'none');
          };



          $('#select_mount_btn a').on('click', modelIsLoaded(function(event) {

            if (this.classList.contains('imitation-select')) {
              mounts_menu_switcher(event.target.parentElement.parentElement.children[2]);
              return false;
            };

            if (this.classList.contains('fa-caret-left')
            && window.dressUI.char.mount > 0) {

              window.dressUI.char.mount -= 1;

            } else if (this.classList.contains('fa-caret-right')
            && window.dressUI.char.mount < window.gameData[0].mounts.length - 1) {

              window.dressUI.char.mount += 1;
            };

            setCurrentMount(window.dressUI.char.mount);
          }));

          function generateMountsMenuHtml() {
            const listview_mode_tiled = $('.listview-mode-tiled')[0];
            const mounts = window.gameData[0].mounts;
            const whTooltipUrl = window.dressUI.game_patch === 'wrath'
            ? "https://www.wowhead.com/wrath/{% if LANGUAGE_CODE == 'ru' %}ru/{% else %}{% endif %}spell="
            : "https://www.wowhead.com/{% if LANGUAGE_CODE == 'ru' %}ru/{% else %}{% endif %}spell=";

            for (const i in mounts) {
              if (mounts[i].displayId === 0) continue;

              const hash = mounts[i].displayId & 255; // Побитовая операция

              listview_mode_tiled.insertAdjacentHTML('beforeEnd',
                `
                <div class="screenshot-cell" index="${i}">
                  <img src="https://wow.zamimg.com/modelviewer/${window.dressUI.game_patch}/webthumbs/npc/${hash}/${mounts[i].displayId}.webp">
                  <div class="screenshot-caption-wrapper">
                    <div class="screenshot-caption">
                      <a class="q" href="${whTooltipUrl}${mounts[i].spellId}">${mounts[i].name}</a>
                    </div>
                  </div>
                </div>
                `
              );
            };

            listview_mode_tiled.addEventListener('click', modelIsLoaded(function(event) {
              event.preventDefault(); // блокирует переход по ссылке но обрабатывает клик и отображает тултип

              if (event.target.classList.contains('screenshot-cell')) {
                checkDuplicateMount(event.target.getAttribute('index'));
              } else if (event.target.tagName === 'IMG') {
                checkDuplicateMount(event.target.parentElement.getAttribute('index'));
              } else if (event.target.classList.contains('screenshot-caption-wrapper')) {
                checkDuplicateMount(event.target.parentElement.getAttribute('index'));
              } else if (event.target.classList.contains('screenshot-caption')) {
                checkDuplicateMount(event.target.parentElement.parentElement.getAttribute('index'));
              } else if (event.target.tagName === 'A') {
                checkDuplicateMount(event.target.parentElement.parentElement.parentElement.getAttribute('index'));
              };
            }));
          };

          function checkDuplicateMount(current_index) {
            if (window.dressUI.char.mount == current_index) {
              // warnMessageHandler(1500, 'Текущий и выбранный маунт одинаковые.');
              return false;
            };
            setCurrentMount(current_index);
          };

          async function setCurrentMount(current_index) {
            window.dressUI.char.mount = parseInt(current_index);

            const current_element_a = $('.listview-mode-tiled')[0].getElementsByTagName("A")[window.dressUI.char.mount];
            removeUnderlineFrom_A(current_element_a.parentElement.parentElement.parentElement);
            current_element_a.classList.add('text-uline');

            const caret_element_a = $('#select_mount_btn').find('a')[1];
            caret_element_a.textContent = window.gameData[0].mounts[window.dressUI.char.mount].name;

            setAlphaForExtremeButtonPosition(
              caret_element_a,
              window.dressUI.char.mount,
              window.gameData[0].mounts.length - 1
            );

            window.dressUI.model_opts.generalOptions.mount.id =
            window.gameData[0].mounts[window.dressUI.char.mount].displayId;

            debounce_sendAjaxRequest();

            $('.paperdoll-model').css('background', 'url(https://wow.zamimg.com/images/icons/ajax.gif) center no-repeat');
            await _generateCharModel();
          };

          function mounts_menu_switcher(mounts_menu) {
            window.dressUI.char.mounts_menu_opened = !window.dressUI.char.mounts_menu_opened;
            window.dressUI.char.mounts_menu_opened ? $(mounts_menu).css('display', 'block') : $(mounts_menu).css('display', 'none');
          };
        </script>

        <script>
          function setAlphaForExtremeButtonPosition(element_a, cur, max, min=0) {

            let caret_left = element_a.parentElement.children[0].classList;
            let imit_select = element_a.parentElement.children[1].classList;
            let caret_right = element_a.parentElement.children[2].classList;

            if (min == max) {
              if (!caret_left.contains('caret-disabled')) caret_left.add('caret-disabled');

              window.dressUI.char.only_item && !imit_select.contains('caret-disabled')
              ? imit_select.add('caret-disabled')
              : imit_select.remove('caret-disabled');

              if (!caret_right.contains('caret-disabled')) caret_right.add('caret-disabled');
              return false;
            };

            if (cur == min) {
              if (!caret_left.contains('caret-disabled')) caret_left.add('caret-disabled');
              if (imit_select.contains('caret-disabled')) imit_select.remove('caret-disabled');
              if (caret_right.contains('caret-disabled')) caret_right.remove('caret-disabled');

            } else if (cur == max) {
              if (caret_left.contains('caret-disabled')) caret_left.remove('caret-disabled');
              if (imit_select.contains('caret-disabled')) imit_select.remove('caret-disabled');
              if (!caret_right.contains('caret-disabled')) caret_right.add('caret-disabled');

            } else {
              if (caret_left.contains('caret-disabled')) caret_left.remove('caret-disabled');
              if (imit_select.contains('caret-disabled')) imit_select.remove('caret-disabled');
              if (caret_right.contains('caret-disabled')) caret_right.remove('caret-disabled');
            };
          };

          function refreshAlphaForExtremeButtonPosition(data) {

            const carets = document.querySelector(data.id).getElementsByClassName("fa-caret-left");

            for (let i=0; i < carets.length; i++) {

              const current = data.key === "char"
              ? window.dressUI[data.key][data.fields[i]]
              : window.dressUI[data.key].current[i];

              setAlphaForExtremeButtonPosition(
                carets[i],
                current,
                data.max_len[i],
                data.min_len[i]
              );
            };
          };


          function findElementByItemId(itemId, slot_btn) {
            const slotItems = slot_btn.parentElement.getElementsByClassName('items-menu-table')[0].getElementsByTagName("A");
            for (let i=0; i < slotItems.length; i++) {
              if (slotItems[i].href.split('=').pop() == itemId) return slotItems[i];
            };
          };

          function findElementByVisualId(visualId, slot_btn) {
            const slotItems = slot_btn.parentElement.getElementsByClassName('items-menu-table')[0].getElementsByTagName("A");
            for (let i=0; i < slotItems.length; i++) {
              if (slotItems[i].getAttribute('visualId') == visualId) return slotItems[i];
            };
          };

          function findElementByRaceId(race_id) {
            const races = document.querySelector('.races-menu-table').getElementsByTagName("A");
            for (let i=0; i < races.length; i++) {
              if (races[i].getAttribute('race_id') == race_id) return races[i];
            };
          };


          function updateItemSlotIcon(flag) {
            // Убрать подчеркивания и иконки выбранных итемов при выходе из режима "Только итемы"
            if (!flag) {
              for (const slotId of [1, 3, 21, 22, 23]) {
                const slot_btn = getSlotBtnBySlotId(slotId);
                const first_element_a = slot_btn.parentElement.getElementsByClassName('items-menu-table')[0].children[0];
                clearItemSlotsIcon(slotId);
                removeUnderlineFrom_A(first_element_a);
              };

              const current_element_a = $('.listview-mode-tiled')[0].getElementsByTagName("A")[window.dressUI.char.mount];
              current_element_a.classList.add('text-uline');
            };

            for (const itemData of window.dressUI.model_opts.items) {
              if (flag) {
                // очищаем иконки слот буттонов от итемов при переключении на режим "Только итемы"
                clearItemSlotsIcon(itemData[0]);
                if (itemData[0] == 21 || itemData[0] == 22) clearItemSlotsIcon(`0${itemData[0]}`);
              } else {
                let slot_btn = getSlotBtnBySlotId(itemData[0]);
                let element_a = findElementByItemId(itemData[2], slot_btn);

                removeUnderlineFrom_A(element_a);
                element_a.classList.add('text-uline');

                setItemSlotIcon(element_a, slot_btn);

                // Установить иконку для enchant слотов совместно со слотами оружия
                if (itemData[0] == 21 || itemData[0] == 22) {
                  slot_btn = getSlotBtnBySlotId(`0${itemData[0]}`);
                  element_a = findElementByVisualId(itemData[3], slot_btn);

                  if (element_a) {
                    removeUnderlineFrom_A(element_a);
                    element_a.classList.add('text-uline');

                    setItemSlotIcon(element_a, slot_btn);
                  };
                };
              };
            };

            if (flag) {
              const slot_btn = getSlotBtnBySlotId(window.dressUI.char.only_item_data.slotId);
              let element_a = findElementByItemId(window.dressUI.char.only_item_data.itemId, slot_btn);
              element_a.classList.add('text-uline');
              setItemSlotIcon(element_a, slot_btn);
            };
          };


          function set_race_gender_image() {
            const race = RACES[window.dressUI.char.race_id].toLowerCase();
            const gender = GENDERS[window.dressUI.char.gender_id].toLowerCase();

            const race_gender_img_url = RACES_WITHOUT_ICON.indexOf(window.dressUI.char.race_id) !== -1
            ? '/static/main_app/images/close.png'
            : `${DEFAULT_ICON_URL}race_${race}_${gender}.jpg`;

            $('#character_button').css('background-image', `url(${race_gender_img_url})`);
          };
        </script>

        <script>
          const gear_button = $('#gear_button')[0];
          const face_button = $('#face_button')[0];
          const char_button = $('#character_button')[0];
          const patch_button = $('#change_game_patch')[0];

          const paperdoll_left = $('.paperdoll-left')[0];
          const paperdoll_right = $('.paperdoll-right')[0];
          const paperdoll_bottom = $('.paperdoll-bottom')[0];

          const face_settings = $('#dressing-room-face-settings')[0];
          const char_settings = $('#dressing-room-character-settings')[0];

          $('.dressing-room-character-controls-category-switchers a').on('click', function(event) {

            const category = event.target.getAttribute('data-category');
            event.target.setAttribute('data-active', 'true');

            if (category === 'gear') {
              removeAttr('data-active', face_button, char_button);
              setDisplayState('block', paperdoll_left, paperdoll_right, paperdoll_bottom);
              setDisplayState('none', face_settings, char_settings);
              window.dressUI.active_cat = 'gear';

              if (!window.dressUI.char.only_item) {
                window.model.renderer.viewer.setZoom(CUR_MODEL_ZOOM);
                window.model.renderer.viewer.setOffset(0, 0);
              };

            } else if (category === 'face') {
              removeAttr('data-active', gear_button, char_button);
              setDisplayState('block', face_settings);
              setDisplayState('none', paperdoll_left, paperdoll_right, paperdoll_bottom, char_settings);
              window.dressUI.active_cat = 'face';

              if (!window.dressUI.char.only_item) setFaceZoom();

            } else if (category === 'character') {
              removeAttr('data-active', gear_button, face_button);
              setDisplayState('block', char_settings);
              setDisplayState('none', paperdoll_left, paperdoll_right, paperdoll_bottom, face_settings);
              window.dressUI.active_cat = 'character';

              if (!window.dressUI.char.only_item) {
                window.model.renderer.viewer.setZoom(CUR_MODEL_ZOOM);
                window.model.renderer.viewer.setOffset(0, 0);
              };
            };
          });


          function setFaceZoom() {
            let zoom = CUR_MODEL_ZOOM;
            let X = 0;
            let Y = 0;
            switch (window.dressUI.model_opts.race) { //          Female                      Male
              case 1:  window.dressUI.model_opts.gender ? (zoom = 12.6, Y = 0.75) : (zoom = 12.6, Y = 0.80); break; // Human
              case 2:  window.dressUI.model_opts.gender ? (zoom = 12.6, Y = 0.75) : (zoom = 8, Y = 0.80); break; // Orc
              case 3:  window.dressUI.model_opts.gender ? (zoom = 9, Y = 0.55) : (zoom = 9, Y = 0.55); break; // Dwarf
              case 4:  window.dressUI.model_opts.gender ? (zoom = 12.6, Y = 0.95) : (zoom = 12.6, Y = 1.00); break; // Nightelf
              case 5:  window.dressUI.model_opts.gender ? (zoom = 12.6, Y = 0.75) : (zoom = 12.6, Y = 0.80); break; // Scourge
              case 6:  window.dressUI.model_opts.gender ? (zoom = 9, Y = 0.80) : (zoom = 6, Y = 0.65); break; // Tauren
              case 7:  window.dressUI.model_opts.gender ? (zoom = 8, Y = 0.25) : (zoom = 7, Y = 0.35); break; // Gnome
              case 8:  window.dressUI.model_opts.gender ? (zoom = 12.6, Y = 0.90) : (zoom = 11, Y = 0.80); break; // Troll
              case 9:  window.dressUI.model_opts.gender ? (zoom = 9, Y = 0.45) : (zoom = 9, Y = 0.45); break; // Goblin
              case 10: window.dressUI.model_opts.gender ? (zoom = 12.6, Y = 0.75) : (zoom = 12.6, Y = 0.80); break; // Bloodelf
              case 11: window.dressUI.model_opts.gender ? (zoom = 12.6, Y = 0.95) : (zoom = 10, Y = 0.95); break; // Draenei
              case 12: (zoom = 9, Y = 0.70); break; // Felorc
              case 13: window.dressUI.model_opts.gender ? (zoom = 9, Y = 0.60) : (zoom = 8, Y = 0.65); break; // Naga_
              case 14: (zoom = 8, Y = 0.85); break; // Broken
              case 15: (zoom = 9, Y = 0.75); break; // Skeleton
              case 16: (zoom = 8, Y = 1.60); break; // Vrykul
              case 17: (zoom = 5, Y = 0.75); break; // Tuskarr
              case 18: (zoom = 6, Y = 0.75); break; // Foresttroll
              case 19: (zoom = 5, Y = 0.65); break; // Taunka
              case 20: (zoom = 5, Y = 1.30); break; // Northrendskeleton
              case 21: (zoom = 6, Y = 0.75); break; // Icetroll
              case 22: window.dressUI.model_opts.gender ? (zoom = 9, Y = 0.85) : (zoom = 8, Y = 0.75); break; // Worgen
              // case 23: window.dressUI.model_opts.gender ? (zoom = 12.6, Y = 0.75) : (zoom = 12.6, Y = 0.80); break; // Gilnean
              case 24: window.dressUI.model_opts.gender ? (zoom = 10, Y = 0.80) : (zoom = 9, Y = 0.85); break; // Pandaren
              // case 25: window.dressUI.model_opts.gender ? (zoom = 10, Y = 0.80) : (zoom = 9, Y = 0.85); break; // Pandarena
              // case 26: window.dressUI.model_opts.gender ? (zoom = 10, Y = 0.80) : (zoom = 9, Y = 0.85); break; // Pandarenh
              case 27: window.dressUI.model_opts.gender ? (zoom = 12, Y = 0.85) : (zoom = 12, Y = 0.90); break; // Nightborne
              case 28: window.dressUI.model_opts.gender ? (zoom = 9, Y = 0.95) : (zoom = 6, Y = 0.60); break; // Highmountaintauren
              case 29: window.dressUI.model_opts.gender ? (zoom = 12.6, X = -0.10, Y = 0.75) : (zoom = 12.6, Y = 0.80); break; // Voidelf
              case 30: window.dressUI.model_opts.gender ? (zoom = 12.6, Y = 0.95) : (zoom = 10, Y = 0.95); break; // Lightforgeddraenei
              case 31: window.dressUI.model_opts.gender ? (zoom = 11, Y = 1.05) : (zoom = 10, Y = 0.95); break; // Zandalaritroll
              case 32: window.dressUI.model_opts.gender ? (zoom = 11, Y = 0.95) : (zoom = 10, Y = 0.95); break; // Kultiran
              case 33: (zoom = 13, Y = 0.75); break; // Thinhuman
              case 34: window.dressUI.model_opts.gender ? (zoom = 9, Y = 0.55) : (zoom = 9, Y = 0.55); break; // Darkirondwarf
              case 35: window.dressUI.model_opts.gender ? (zoom = 7, Y = 0.35) : (zoom = 8, Y = 0.40); break; // Vulpera
              case 36: window.dressUI.model_opts.gender ? (zoom = 12.6, Y = 0.75) : (zoom = 8, Y = 0.80); break; // Magharorc
              case 37: window.dressUI.model_opts.gender ? (zoom = 6, Y = 0.30) : (zoom = 7, Y = 0.35); break; // Mechagnome
            };
            window.model.renderer.viewer.setZoom(zoom);
            window.model.renderer.viewer.setOffset(X, Y);
          };


          $('#dr-toggle-ui').on('click', function(event) {
            window.dressUI.show = !window.dressUI.show;

            if (window.dressUI.show) {
              setDisplayState('none', gear_button, face_button, char_button, patch_button,
              paperdoll_left, paperdoll_right, paperdoll_bottom, face_settings, char_settings, my_saved_rooms_container);
            } else {
              setDisplayState('block', gear_button, face_button, char_button, patch_button);
              if (window.dressUI.saved_rooms) my_saved_rooms_container.style.display = 'grid';

              if (window.dressUI.active_cat === 'gear') {
                setDisplayState('block', paperdoll_left, paperdoll_right, paperdoll_bottom);
              } else if (window.dressUI.active_cat === 'face') {
                setDisplayState('block', face_settings);
              } else if (window.dressUI.active_cat === 'character') {
                setDisplayState('block', char_settings);
              };
            };
          });


          function removeAttr(attr, ...elements) { for (let element of elements) element.removeAttribute(attr); };

          function setDisplayState(state, ...elements) { for (let element of elements) element.style.display = state; };


          const copy_text = new CopyText();
        </script>

        <script id="viewer-utils"></script>
        <script>
          // фикс ошибки: Uncaught ReferenceError: ZamModelViewer is not defined
          const viewer_utils = document.querySelector('#viewer-utils');

          const waitLibraryIsLoading = function(callback_func, ...args) {
            window.requestAnimationFrame(callback_func.bind(callback_func, ...args));
            return;
          };

          const isLibraryLoaded = function(obj) {
            return obj !== undefined;
          };

          const loadingLibraries = function(...args) {

            if (!isLibraryLoaded(window.ZamModelViewer)) {
              waitLibraryIsLoading(loadingLibraries, ...args);
              return;
            };

            if (!viewer_utils.src) viewer_utils.src = "{% static 'main_app/javascript/wow-model-viewer/model_viewer_utils.js' %}";

            if (!isLibraryLoaded(window.WowModelViewer)) {
              waitLibraryIsLoading(loadingLibraries, ...args);
              return;
            };

            if (!isLibraryLoaded(window.gameData)) {
              waitLibraryIsLoading(loadingLibraries, ...args);
              return;
            };

            $(document).ready(function() {

              window.generateCharModel();

              //////////////// TEST №1 STRESS TEST CHAR MODEL ////////////////
              // window.dressUI.model_opts.items = [ // items with CORS policy
              //   [1,  64897,  51281, 0],
              //   [3,  64896,  51284, 0],
              //   [16, 22996,  54583, 0],
              //   [5,  64859,  51283, 0],
              //   [4,  11977,  45280, 0],
              //   [19, 65733,  52252, 0],
              //   [9,  63901,  54582, 0],
              //   [21, 65153,  49623, 155],
              //   [22, 45146,  32838, 165],
              //   [10, 63910,  51280, 0],
              //   [6,  109302, 50702, 0],
              //   [7,  64246,  51282, 0],
              //   [8,  63825,  50699, 0]
              // ];
              // window.generateCharModel();
              // setInterval(function() { modelIsLoaded(window.generateCharModel)(); }, 4);
              //////////////// TEST №1 STRESS TEST CHAR MODEL ////////////////

              //////////////// TEST №2 STRESS TEST ITEM MODEL ////////////////
              // window.dressUI.char.only_item = true;
              // window.generateItemModel({type: 1, id: 65153, itemId: 49623, slotId: 21});
              // setInterval(function() { modelIsLoaded(window.generateItemModel)({type: 1, id: 65153, itemId: 49623, slotId: 21}); }, 4);
              //////////////// TEST №2 STRESS TEST ITEM MODEL ////////////////
            });
          };
          $('.paperdoll-model').css('background', 'url(https://wow.zamimg.com/images/icons/ajax.gif) center no-repeat');
          loadingLibraries();
        </script>

        <script>
          window.generateFaceOptionHtml = function(i, optionName) {
            const caret_left = document.createElement('a');
            caret_left.classList.add('btn', 'dress-btn', 'fa', 'fa-caret-left');
            caret_left.setAttribute('href', 'javascript:');
            caret_left.setAttribute('tabindex', '-1');

            const imit_sel = document.createElement('a');
            imit_sel.classList.add('imitation-select');
            imit_sel.setAttribute('data-field-filled', 'true');
            imit_sel.setAttribute('href', 'javascript:');
            imit_sel.setAttribute('tabindex', '-1');
            // если опция без названий будем использовать просто индексы
            imit_sel.textContent = window.dressUI.face.have_text_opt[i]
            ? window.dressUI.face.have_text_opt[i]
            : window.dressUI.face.current[i] + 1;

            const caret_right = document.createElement('a');
            caret_right.classList.add('btn', 'dress-btn', 'fa', 'fa-caret-right');
            caret_right.setAttribute('href', 'javascript:');
            caret_right.setAttribute('tabindex', '-1');

            const caret_div = document.createElement('div');
            caret_div.setAttribute('tabindex', '0');
            caret_div.setAttribute('data-role', 'control');
            caret_div.appendChild(caret_left);
            caret_div.appendChild(imit_sel);
            caret_div.appendChild(caret_right);

            const label = document.createElement('div');
            label.setAttribute('data-role', 'label');
            label.textContent = optionName;

            const cat_opt_div = document.createElement('div');
            cat_opt_div.classList.add('dressing-room-character-controls-category-option');
            cat_opt_div.setAttribute('data-character-customization-type', window.dressUI.face.fields[i]);
            cat_opt_div.appendChild(label);
            cat_opt_div.appendChild(caret_div);

            face_settings.appendChild(cat_opt_div);

            return cat_opt_div;
          };


          const generateFaceOptions = function() {
            const NOT_ALLOWED_CHAR_OPTS = [
              'Eyesight', 'Bear Form', 'Cat Form', 'Moonkin Form', 'Aquatic Form', 'Flight Form', 'Travel Form'
            ];
            const race_gender_opts = window.dressUI.face.race_gender_opts;

            // очистка настроек при создании новой модели
            window.dressUI.face.fields = [];
            window.dressUI.face.max_len = [];
            window.dressUI.face.min_len = [];
            window.dressUI.face.have_text_opt = [];

            if (window.dressUI.face.current.length === 0) {
              window.dressUI.face.current =
              ((len, char) => Array.from({ length: len }, () => char))(race_gender_opts.length, 0);
            };

            for (const i in race_gender_opts) {
              const option = race_gender_opts[i];

              if (NOT_ALLOWED_CHAR_OPTS.indexOf(option.Name) !== -1) continue;

              const opt_name = option.Name.replace(' ', '_').toLowerCase();

              const choice_name = option.Choices[window.dressUI.face.current[i]].Name;

              const max_len = option.Choices.length - 1;

              window.dressUI.face.fields.push(opt_name);
              window.dressUI.face.max_len.push(max_len);
              window.dressUI.face.min_len.push(0);
              window.dressUI.face.have_text_opt.push(choice_name);

              window.dressUI.model_opts[opt_name] = window.dressUI.face.current[i];

              const cat_opt_div = window.generateFaceOptionHtml(i, option.Name);


              cat_opt_div.addEventListener('click', modelIsLoaded(function(event) {

                if (event.target.classList.contains('fa-caret-left') && window.dressUI.face.current[i] > 0) {
                  window.dressUI.face.current[i] -= 1;
                } else if (event.target.classList.contains('fa-caret-right') && window.dressUI.face.current[i] < max_len) {
                  window.dressUI.face.current[i] += 1;
                };
                setAlphaForExtremeButtonPosition(event.target, window.dressUI.face.current[i], max_len);

                event.target.parentElement.children[1].textContent = choice_name
                ? race_gender_opts[i].Choices[window.dressUI.face.current[i]].Name
                : window.dressUI.face.current[i] + 1;

                window.dressUI.model_opts[opt_name] = window.dressUI.face.current[i];
                window.model.updateAppearance(window.dressUI.model_opts);
              }));
            };
          };


          const _generateCharModel = async function() {
            if (window.model) window.model.renderer.models[0].modelIsLoaded = false;

            CUR_MODEL_ZOOM = window.dressUI.model_opts.generalOptions.mount.id === 0 ? -3 : 0;

            // Полная очистка html старых анимаций
            $('.anims-menu-table a').each(function(index, option) { option.remove(); });

            // глубокая копия window.dressUI.model_opts для удаления itemId и visualId из items перед генерацией модели
            let dc_model_opts = JSON.parse(JSON.stringify(window.dressUI.model_opts));
            dc_model_opts.items = [];
            dc_model_opts.items = window.dressUI.model_opts.items.map(item => [item[0], item[1]]);

            // console.log(...dc_model_opts.items);
            // console.log(...window.dressUI.model_opts.items);

            // Принудительно удаляю 21, 22, 23 слоты из dc_model_opts для того
            // чтобы у маунта при загрузке не было оружия в копытах..
            // после загрузки модели, оружие будет установлено обратно на персонажа.
            if (dc_model_opts.generalOptions.mount.id !== 0) {
              for (const slotId of [21, 22, 23]) {
                const index = slotIdIsExists(slotId, dc_model_opts.items);
                if (index !== false) dc_model_opts.items.splice(index, 1);
              };
            };

            window.model = await generateModels(
              '#paperdoll-model-dressing-room-paperdoll',
              dc_model_opts
            );

            // console.log(window.model.renderer) // class gl
            // console.log(window.model.renderer.viewer) // class dl
            // console.log(window.model.renderer.models[0]) // class ul

            window.model.setModelLoadedCallback(async function() {
              $('.paperdoll-model').css('background', 'none');

              // Установить оружие и визуальный эффект на оружие после загрузки модели
              const setGameData = [];
              for (const slotId of [21, 22, 23]) {
                const index = slotIdIsExists(slotId);
                if (index !== false) setGameData.push({
                  slot: window.dressUI.model_opts.items[index][0],
                  display: window.dressUI.model_opts.items[index][1],
                  visual: window.dressUI.model_opts.items[index][3]
                });
              };
              setTimeout(function() {
                window.model.renderer.viewer.method("setItems", [setGameData]);
              }, dc_model_opts.generalOptions.mount.id !== 0 ? 150 : 4);

              updateSheathInfo();

              updateAnimPaused(true);

              window.model.renderer.viewer.setZoom(CUR_MODEL_ZOOM);


              await window.model.getListAnimations(function({animNames, defaultIndex}) {
                window.dressUI.char.anims_list = animNames;
                window.dressUI.char.default_anim = defaultIndex;
                window.dressUI.char.anim = defaultIndex;

                setDefaultText();

                const char_data = {
                  id: '#dressing-room-character-settings',
                  key: 'char',
                  fields: ['race_id', 'gender_id', 'sheath', 'anim', 'mount'],
                  max_len: [RACES_LEN, 1, window.dressUI.char.sheath_opts.length - 1,
                  window.dressUI.char.anims_list.length - 1, window.gameData[0].mounts.length - 1],
                  min_len: [1, 0, 0, 0, 0]
                };

                if (ONLY_MALE_RACES.indexOf(window.dressUI.model_opts.race) !== -1) {
                  char_data.max_len[1] = 0;
                };

                refreshAlphaForExtremeButtonPosition(char_data);

                generateAnimsMenuHtml();

                const current_element_a = $('.anims-menu-table')[0].getElementsByTagName("A")[window.dressUI.char.anim];
                current_element_a.classList.add('text-uline');
              });
            });

            // window.model.renderer.viewer.method("setCustomizationsLoadedCallback", function(t) { console.log('setCustomizationsLoadedCallback', t); });
            // window.model.renderer.screenshotCallback = function() { console.log('screenshotCallback'); };

            set_race_gender_image();
          };


          window.generateCharModel = function() {
            if (window.model) window.model.renderer.models[0].modelIsLoaded = false;

            window.dressUI.model_opts.generalOptions.mount.id =
            window.gameData[0].mounts[window.dressUI.char.mount].displayId;

            $('.paperdoll-model').css('background', 'url(https://wow.zamimg.com/images/icons/ajax.gif) center no-repeat');

            $('#dressing-room-face-settings div').each(function(index, option) {
              if (option.classList.contains('dressing-room-character-controls-category-option')) {
                delete window.dressUI.model_opts[option.getAttribute('data-character-customization-type')];
                option.remove();
              };
            });

            if (ONLY_MALE_RACES.indexOf(window.dressUI.model_opts.race) !== -1) {
              window.dressUI.model_opts.gender = 0;
              window.dressUI.char.gender_id = 0;
              updateGenderImagesInRacesMenu();
            };

            updateItemSlotIcon(false);

            const current_element_a = findElementByRaceId(window.dressUI.model_opts.race);
            current_element_a.classList.add('text-uline');

            // Получить все доступные опции для указанной расы и гендера
            findRaceGenderOptions(window.dressUI.model_opts.race, window.dressUI.model_opts.gender).then((fullOptions) => {
              window.dressUI.face.race_gender_opts = fullOptions.Options;

              generateFaceOptions();

              refreshAlphaForExtremeButtonPosition(window.dressUI.face);

              _generateCharModel();
            });
          };


          window.generateItemModel = async function(opts) {
            if (window.model) window.model.renderer.models[0].modelIsLoaded = false;

            $('.paperdoll-model').css('background', 'url(https://wow.zamimg.com/images/icons/ajax.gif) center no-repeat');

            window.model = await generateModels(
              '#paperdoll-model-dressing-room-paperdoll',
              opts
            );

            window.model.setModelLoadedCallback(function() {
              $('.paperdoll-model').css('background', 'none');

              window.dressUI.AnimIsPaused = false;
              updateAnimPaused();

              document.documentElement.clientWidth < 800
              ? window.model.renderer.viewer.setZoom(-3)
              : window.model.renderer.viewer.setZoom(-8);
            });
          };


          $('#only-item').on('click', modelIsLoaded(function(event) {
            window.dressUI.char.only_item = event.target.checked;

            if (window.dressUI.char.only_item) {
              const char_data = {
                id: '#dressing-room-character-settings',
                key: 'char',
                fields: ['race_id', 'gender_id', 'sheath', 'anim', 'mount'],
                max_len: [1, 0, 0, 0, 0],
                min_len: [1, 0, 0, 0, 0]
              };
              refreshAlphaForExtremeButtonPosition(char_data);

              let dc_face_data = JSON.parse(JSON.stringify(window.dressUI.face));
              dc_face_data.max_len = [];
              for (const _ in dc_face_data.fields) dc_face_data.max_len.push(0);
              refreshAlphaForExtremeButtonPosition(dc_face_data);

              warnMessageHandler(4000, "{% trans 'Теперь вы можете просматривать итемы без персонажа.' %}");
              updateItemSlotIcon(true);
              window.generateItemModel(window.dressUI.char.only_item_data);
            } else {
              warnMessageHandler(4000, "{% trans 'Теперь вы можете просматривать итемы на персонаже.' %}");
              updateItemSlotIcon(false);
              window.generateCharModel();
            };
          }));


          function get_game_data_from_database_file() {
            fetch("{% static 'main_app/json/gameData.json' %}")
            .then((response) => response.json())
            // .then((json) => json.map((x) => {
            //   x.icon = `${DEFAULT_ICON_URL}${x.icon}.jpg`;
            //   return x;
            // }))
            .then((data) => {
              window.gameData = data;

              if (window.dressUI.game_patch === 'wrath') {
                // только первые 290шт. массива wrath маунты
                window.gameData[0].mounts = window.gameData[0].mounts.slice(0, WRATH_MOUNTS_LEN);
                // только первые 28шт. массива wrath чарки
                window.gameData[0].enchants = window.gameData[0].enchants.slice(0, WRATH_ENCHANTS_LEN);
              };

              // по дефолту маунты отсортированы от ванилы к лайву,
              // сортируем их в обратном порядке
              window.gameData[0].mounts.reverse();

              // добавляю первый элемент пустышку для возможности отключения маунта
              window.gameData[0].mounts.unshift({"spellId": 0, "displayId": 0, "name": "None"});
              creatingItemsMenu();
              generateMountsMenuHtml();
            });
          };
          get_game_data_from_database_file();
        </script>

        <script>
          function updateFaceFields(random_vals=true) {
            const NOT_ALLOWED_FACE_FIELDS = [
            ];

            const face_data = window.dressUI.face;

            for (const i in face_data.fields) {

              const field_name = face_data.fields[i];

              if (NOT_ALLOWED_FACE_FIELDS.indexOf(field_name) !== -1) continue;

              const max_len = face_data.max_len[i];

              let int_param = random_vals ? get_rand_int(0, max_len) : face_data.current[i];

              // эта настройка больше 19 выглядит не красиво
              if (field_name === 'eye_color' && int_param > 19) int_param = get_rand_int(0, 18);

              window.dressUI.model_opts[field_name] = int_param;
              face_data.current[i] = int_param;

              const imit_sel = $(`.dressing-room-character-controls-category-option[data-character-customization-type="${field_name}"]`).find('a')[1];
              imit_sel.textContent = face_data.have_text_opt[i]
              ? window.dressUI.face.race_gender_opts[i].Choices[int_param].Name
              : int_param + 1;

              setAlphaForExtremeButtonPosition(imit_sel, int_param, max_len);
            };
          };


          $('#dr-randomize').on('click', modelIsLoaded(function(event) {
            if (window.dressUI.char.only_item) return false;
            updateFaceFields();
            window.model.updateAppearance(window.dressUI.model_opts);
          }));


          $('#dr-reset').on('click', modelIsLoaded(function(event) {

            if (document.documentElement.clientWidth < 800) {
              window.dressUI.char.only_item
              ? window.model.renderer.viewer.setZoom(-3)
              : window.model.renderer.viewer.setZoom(CUR_MODEL_ZOOM); // range(-14.5, 12.6)
            } else {
              window.dressUI.char.only_item
              ? window.model.renderer.viewer.setZoom(-8)
              : window.model.renderer.viewer.setZoom(CUR_MODEL_ZOOM);
            };

            // window.model.renderer.distance = 6;
            window.model.renderer.azimuth = 1.5 * Math.PI; // горизонталь
            window.model.renderer.zenith = Math.PI / 2; // вертикаль
            window.model.renderer.viewer.setOffset(0, 0); // X, Y

            if (!window.dressUI.char.only_item) {
              window.dressUI.char.anim = window.dressUI.char.default_anim;

              setAlphaForExtremeButtonPosition(
                $('#select_animation_btn')[0].children[0],
                window.dressUI.char.anim,
                window.dressUI.char.anims_list.length - 1,
                0
              );
              setAnim(window.dressUI.char.anim);
            };
          }, true));


          $('#dr-screenshot').on('click', modelIsLoaded(function(event) {
            window.model.makeScreenshot();
          }, true));


          const dr_pause = $('#dr-pause');
          dr_pause.on('click', modelIsLoaded(function(event) {
            window.dressUI.AnimIsPaused = !window.dressUI.AnimIsPaused;
            updateAnimPaused(true);
          }, true));

          function updateAnimPaused(flag) {
            if (window.dressUI.AnimIsPaused) {
              dr_pause[0].classList.remove('fa-pause');
              dr_pause[0].classList.add('fa-play');
            } else {
              dr_pause[0].classList.remove('fa-play');
              dr_pause[0].classList.add('fa-pause');
            };
            if (flag) setTimeout(() => {
              window.model.renderer.viewer.method("setAnimPaused", window.dressUI.AnimIsPaused);
            }, 10);
          };
        </script>

      </div>
    </div>
  </div>
</app-dressing-room>
{% endblock %}
